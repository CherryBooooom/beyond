!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=11)}([function(t,e){var i=window.BMapLib=i||{};!function(){function t(t,i){var n=e(t),o=new BMap.Polyline(n,i);return o.addEventListener("lineupdate",function(){this.isEditing&&this.enableEditing()}),o.cornerPoints=t,o.editMarkers=[],o.enableEditing=function(){var t=this;if(t.map){t.disableEditing();for(var i=0;i<t.cornerPoints.length;i++){var n=new BMap.Marker(t.cornerPoints[i],{icon:new BMap.Icon("http://api.map.baidu.com/library/CurveLine/1.5/src/circle.png",new BMap.Size(16,16)),enableDragging:!0,raiseOnDrag:!0});n.addEventListener("dragend",function(){t.cornerPoints.length=0;for(var i=0;i<t.editMarkers.length;i++)t.cornerPoints.push(t.editMarkers[i].getPosition());var n=e(t.cornerPoints);t.setPath(n)}),n.index=i,t.editMarkers.push(n),t.map.addOverlay(n)}}t.isEditing=!0},o.disableEditing=function(){this.isEditing=!1;for(var t=0;t<this.editMarkers.length;t++)this.map.removeOverlay(this.editMarkers[t]),this.editMarkers[t]=null;this.editMarkers.length=0},o.getPath=function(){return n},o}function e(t){for(var e=[],i=0;i<t.length-1;i++){var o=n(t[i],t[i+1]);o&&o.length>0&&(e=e.concat(o))}return e}function n(t,e){if(!(t&&e&&t instanceof BMap.Point&&e instanceof BMap.Point))return null;var i=function(t){return 1-2*t+t*t},n=function(t){return 2*t-2*t*t},o=function(t){return t*t};curveCoordinates=[];var s,a,r,l,p,h,c=0,d=0;if(void 0===e)return void("undefined"!=typeof curveCoordinates&&(curveCoordinates=[]));var _=parseFloat(t.lat),u=parseFloat(e.lat),g=parseFloat(t.lng),f=parseFloat(e.lng);for(f>g&&parseFloat(f-g)>180&&g<0&&(g=parseFloat(360+g)),g>f&&parseFloat(g-f)>180&&f<0&&(f=parseFloat(360+f)),0,h=0,u==_?(s=0,a=g-f):f==g?(s=Math.PI/2,a=_-u):(s=Math.atan((u-_)/(f-g)),a=(u-_)/Math.sin(s)),0==h&&(h=s+Math.PI/5),r=a/2,p=r*Math.cos(h)+g,l=r*Math.sin(h)+_,c=0;c<31;c++)curveCoordinates.push(new BMap.Point(g*i(d)+p*n(d)+f*o(d),_*i(d)+l*n(d)+u*o(d))),d+=1/30;return curveCoordinates}i.CurveLine=t}()},function(t,e){var i=window.BMapLib=i||{};!function(){function t(t){var t=window.event||t;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}var e=e||{guid:"$BAIDU$"};!function(){window[e.guid]={},e.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},e.lang=e.lang||{},e.lang.guid=function(){return"TANGRAM__"+(window[e.guid]._counter++).toString(36)},window[e.guid]._counter=window[e.guid]._counter||1,window[e.guid]._instances=window[e.guid]._instances||{},e.lang.Class=function(t){this.guid=t||e.lang.guid(),window[e.guid]._instances[this.guid]=this},window[e.guid]._instances=window[e.guid]._instances||{},e.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},e.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},e.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},e.lang.Class.prototype.dispose=function(){delete window[e.guid]._instances[this.guid];for(var t in this)e.lang.isFunction(this[t])||delete this[t];this.disposed=!0},e.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},e.lang.Class.prototype.addEventListener=function(t,i,n){if(e.lang.isFunction(i)){!this.__listeners&&(this.__listeners={});var o,s=this.__listeners;if("string"==typeof n&&n){if(/[^\w\-]/.test(n))throw"nonstandard key:"+n;i.hashCode=n,o=n}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof s[t]&&(s[t]={}),o=o||e.lang.guid(),i.hashCode=o,s[t][o]=i}},e.lang.Class.prototype.removeEventListener=function(t,i){if(e.lang.isFunction(i))i=i.hashCode;else if(!e.lang.isString(i))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var n=this.__listeners;n[t]&&n[t][i]&&delete n[t][i]},e.lang.Class.prototype.dispatchEvent=function(t,i){e.lang.isString(t)&&(t=new e.lang.Event(t)),!this.__listeners&&(this.__listeners={}),i=i||{};for(var n in i)t[n]=i[n];var n,o=this.__listeners,s=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=s.indexOf("on")&&(s="on"+s),e.lang.isFunction(this[s])&&this[s].apply(this,arguments),"object"==typeof o[s])for(n in o[s])o[s][n].apply(this,arguments);return t.returnValue},e.lang.inherits=function(t,e,i){var n,o,s=t.prototype,a=new Function;a.prototype=e.prototype,o=t.prototype=new a;for(n in s)o[n]=s[n];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof i&&(o._className=i)},e.dom=e.dom||{},e._g=e.dom._g=function(t){return e.lang.isString(t)?document.getElementById(t):t},e.g=e.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},e.insertHTML=e.dom.insertHTML=function(t,i,n){t=e.dom.g(t);var o,s;return t.insertAdjacentHTML?t.insertAdjacentHTML(i,n):(o=t.ownerDocument.createRange(),i=i.toUpperCase(),"AFTERBEGIN"==i||"BEFOREEND"==i?(o.selectNodeContents(t),o.collapse("AFTERBEGIN"==i)):(s="BEFOREBEGIN"==i,o[s?"setStartBefore":"setEndAfter"](t),o.collapse(s)),o.insertNode(o.createContextualFragment(n))),t},e.ac=e.dom.addClass=function(t,i){t=e.dom.g(t);for(var n=i.split(/\s+/),o=t.className,s=" "+o+" ",a=0,r=n.length;a<r;a++)s.indexOf(" "+n[a]+" ")<0&&(o+=(o?" ":"")+n[a]);return t.className=o,t},e.event=e.event||{},e.event._listeners=e.event._listeners||[],e.on=e.event.on=function(t,i,n){i=i.replace(/^on/i,""),t=e._g(t);var o,s=function(e){n.call(t,e)},a=e.event._listeners,r=e.event._eventFilter,l=i;return i=i.toLowerCase(),r&&r[i]&&(o=r[i](t,i,s),l=o.type,s=o.listener),t.addEventListener?t.addEventListener(l,s,!1):t.attachEvent&&t.attachEvent("on"+l,s),a[a.length]=[t,i,n,s,l],t},e.un=e.event.un=function(t,i,n){t=e._g(t),i=i.replace(/^on/i,"").toLowerCase();for(var o,s,a,r=e.event._listeners,l=r.length,p=!n;l--;)o=r[l],o[1]!==i||o[0]!==t||!p&&o[2]!==n||(s=o[4],a=o[3],t.removeEventListener?t.removeEventListener(s,a,!1):t.detachEvent&&t.detachEvent("on"+s,a),r.splice(l,1));return t},e.preventDefault=e.event.preventDefault=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}}();var n=i.DistanceTool=function(t,i){t&&(this._map=t,i=i||{},this._opts=e.extend(e.extend(this._opts||{},{tips:"测距",followText:"单击确定地点，双击结束",unit:"metric",lineColor:"#ff6319",lineStroke:2,opacity:.8,lineStyle:"solid",cursor:"http://api.map.baidu.com/images/ruler.cur",secIcon:null,closeIcon:null}),i),this._followTitle=null,this._points=[],this._paths=[],this._dots=[],this._segDistance=[],this._overlays=[],this._enableMassClear=!0,this._units={metric:{name:"metric",conv:1,incon:1e3,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"英尺",u2:"英里"}},this._isOpen=!1,this._startFollowText="单击确定起点",this._movingTimerId=null,this._styles={BMapLib_diso:"height:17px;width:5px;position:absolute;background:url(http://api.map.baidu.com/images/dis_box_01.gif) no-repeat left top",BMapLib_disi:"color:#7a7a7a;position:absolute;left:5px;padding:0 4px 1px 0;line-height:17px;background:url(http://api.map.baidu.com/images/dis_box_01.gif) no-repeat right top",BMapLib_disBoxDis:"color:#ff6319;font-weight:bold"},this._opts.lineStroke<=0&&(this._opts.lineStroke=2),this._opts.opacity>1?this._opts.opacity=1:this._opts.opacity<0&&(this._opts.opacity=0),"solid"!=this._opts.lineStyle&&"dashed"!=this._opts.lineStyle&&(this._opts.lineStyle="solid"),this._units[this._opts.unit]||(this._opts.unit="metric"),this.text="测距")};e.lang.inherits(n,e.lang.Class,"DistanceTool"),n.prototype._bind=function(){this._setCursor(this._opts.cursor);var t=this;if(e.on(this._map.getContainer(),"mousemove",function(e){if(t._isOpen&&t._followTitle){e=window.event||e;if((e.target||e.srcElement)!=o.getDom(t._map))return void t._followTitle.hide();t._mapMoving||t._followTitle.show();var i=o.getDrawPoint(e,!0);t._followTitle.setPosition(i)}}),this._startFollowText){this._followTitle=new BMap.Label(this._startFollowText,{offset:new BMap.Size(14,16)});this._followTitle.setStyles({color:"#333",borderColor:"#ff0103"})}},n.prototype.open=function(){if(1==this._isOpen)return!0;if(!i._toolInUse){this._isOpen=!0,i._toolInUse=!0,this._mapMoving&&delete this._mapMoving;var t=this;this._binded||(this._binded=!0,this._bind(),this._map.addEventListener("moving",function(){t._hideCurrent()})),this._followTitle&&(this._map.addOverlay(this._followTitle),this._followTitle.hide());var n=function(i){var n=t._map;if(t._isOpen){i=window.event||i;var s=o.getDrawPoint(i,!0);if(t._isPointValid(s)){if(t._bind.initX=i.pageX||i.clientX||0,t._bind.initY=i.pageY||i.clientY||0,t._points.length>0){var a=n.pointToPixel(t._points[t._points.length-1]),r=n.pointToPixel(s);if(Math.sqrt(Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2))<5)return}t._bind.x=i.layerX||i.offsetX||0,t._bind.y=i.layerY||i.offsetY||0,t._points.push(s),t._addSecPoint(s),0==t._paths.length&&t._formatTitle(1,t._opts.followText,t._getTotalDistance()),t._paths.length>0&&(t._paths[t._paths.length-1].show(),t._paths[t._paths.length-1].setStrokeOpacity(t._opts.opacity));var l=new BMap.Polyline([s,s],{enableMassClear:t._enableMassClear});if(t._map.addOverlay(l),t._paths.push(l),t._overlays.push(l),l.setStrokeWeight(t._opts.lineStroke),l.setStrokeColor(t._opts.lineColor),l.setStrokeOpacity(t._opts.opacity/2),l.setStrokeStyle(t._opts.lineStyle),t._mapMoving&&l.hide(),t._points.length>1){t._paths[t._points.length-2].setPositionAt(1,s)}var p="";if(t._points.length>1){var h=(t._setSegDistance(t._points[t._points.length-2],t._points[t._points.length-1]),t._getTotalDistance());p=t._formatDisStr(h)}else p="起点";var c=new BMap.Label(p,{offset:new BMap.Size(10,-5),enableMassClear:t._enableMassClear});c.setStyles({color:"#333",borderColor:"#ff0103"}),t._map.addOverlay(c),t._formatSegLabel(c,p),t._overlays.push(c),s.disLabel=c,c.setPosition(s);var d=new e.lang.Event("onaddpoint");d.point=s,d.pixel=t._map.pointToPixel(s),d.index=t._points.length-1,d.distance=t._getTotalDistance().toFixed(0),t.dispatchEvent(d)}}},s=function(e){if(t._isOpen)if(t._paths.length>0){e=window.event||e;var i=e.pageX||e.clientX||0,n=e.pageY||e.clientY||0;void 0===t._bind.initX&&(t._bind.x=e.layerX||e.offsetX||0,t._bind.y=e.layerY||e.offsetY||0,t._bind.initX=i,t._bind.initY=n);var a=t._bind.x+i-t._bind.initX,r=t._bind.y+n-t._bind.initY,l=t._paths[t._paths.length-1],p=t._map.pixelToPoint(new BMap.Pixel(a,r));l.setPositionAt(1,p),t._mapMoving||l.show();var h=0,c=0;if(a<10?h=8:a>t._map.getSize().width-10&&(h=-8),r<10?c=8:r>t._map.getSize().height-10&&(c=-8),0!=h||0!=c)s._movingTimerId||(t._mapMoving=!0,t._map.panBy(h,c,{noAnimation:!0}),t._movingTimerId=s._movingTimerId=setInterval(function(){t._map.panBy(h,c,{noAnimation:!0})},30),l.hide(),t._followTitle&&t._followTitle.hide());else if(s._movingTimerId){clearInterval(s._movingTimerId),delete s._movingTimerId,delete t._movingTimerId;var d=t._paths[t._paths.length-1],_=t._map.pixelToPoint(new BMap.Pixel(a,r));if(!d)return;d.setPositionAt(1,_),d.show(),t._followTitle&&(t._followTitle.setPosition(_),t._followTitle.show()),t._bind.i=0,t._bind.j=0,delete t._mapMoving}if(t._followTitle){var u=t._getTotalDistance(),g=t._map.getDistance(t._points[t._points.length-1],p);t._updateInstDis(t._followTitle,u+g)}}else if(t._followTitle){t._followTitle.show(),e=window.event||e;var f=e.target||e.srcElement;f!=o.getDom()&&t._followTitle.hide()}},a=function(i){t._isOpen&&(e.un(o.getDom(t._map),"click",n),e.un(document,"mousemove",s),e.un(o.getDom(t._map),"dblclick",a),e.un(document,"keydown",r),e.un(o.getDom(t._map),"mouseup",l),setTimeout(function(){t.close()},50))},r=function(e){e=window.event||e,27==e.keyCode&&(t._clearCurData(),setTimeout(function(){t.close()},50))},l=function(e){e=window.event||e;var i=0;/msie (\d+\.\d)/i.test(navigator.userAgent)&&(i=document.documentMode||+RegExp.$1),(i&&1!=e.button||2==e.button)&&t.close()};return t._initData(),this._formatTitle(),o.show(this._map),this._setCursor(this._opts.cursor),e.on(o.getDom(this._map),"click",n),e.on(document,"mousemove",s),e.on(o.getDom(this._map),"dblclick",a),e.on(document,"keydown",r),e.on(o.getDom(this._map),"mouseup",l),this.bindFunc=[{elem:o.getDom(this._map),type:"click",func:n},{elem:o.getDom(this._map),type:"dblclick",func:a},{elem:document,type:"mousemove",func:s},{elem:document,type:"keydown",func:r},{elem:o.getDom(this._map),type:"mouseup",func:l}],!0}},n.prototype._dispatchLastEvent=function(){var t=new e.lang.Event("ondrawend");t.points=this._points?this._points.slice(0):[],t.overlays=this._paths?this._paths.slice(0,this._paths.length-1):[],t.distance=this._getTotalDistance().toFixed(0),this.dispatchEvent(t)},n.prototype.close=function(){if(0!=this._isOpen){this._isOpen=!1,i._toolInUse=!1,this._mapMoving&&delete this._mapMoving;var t=this;if(t._dispatchLastEvent(),t._points.length<2)t._clearCurData();else{t._paths[t._paths.length-1].remove(),t._paths[t._paths.length-1]=null,t._paths.length=t._paths.length-1;var n=t._points[t._points.length-1];n.disLabel&&n.disLabel.remove(),t._processLastOp()}o.hide();for(var s=0,a=this.bindFunc.length;s<a;s++)e.un(this.bindFunc[s].elem,this.bindFunc[s].type,this.bindFunc[s].func);t._movingTimerId&&(clearInterval(t._movingTimerId),t._movingTimerId=null),this._followTitle&&this._followTitle.hide()}},n.prototype._clearCurData=function(){for(var t=0,e=this._points.length;t<e;t++)this._points[t].disLabel&&this._points[t].disLabel.remove();for(var t=0,e=this._paths.length;t<e;t++)this._paths[t].remove();for(var t=0,e=this._dots.length;t<e;t++)this._dots[t].remove();this._initData()},n.prototype._initData=function(){this._points.length=0,this._paths.length=0,this._segDistance.length=0,this._dots.length=0},n.prototype._setSegDistance=function(t,e){if(t&&e){var i=this._map.getDistance(t,e);return this._segDistance.push(i),i}},n.prototype._getTotalDistance=function(){for(var t=0,e=0,i=this._segDistance.length;e<i;e++)t+=this._segDistance[e];return t},n.prototype._convertUnit=function(t,e){return e=e||"metric",this._units[e]?t*this._units[e].conv:t},n.prototype._addSecPoint=function(t){var e=this._opts.secIcon?this._opts.secIcon:new BMap.Icon("http://api.map.baidu.com/images/mapctrls.png",new BMap.Size(11,11),{imageOffset:new BMap.Size(-26,-313)}),i=new BMap.Marker(t,{icon:e,clickable:!1,baseZIndex:35e5,zIndexFixed:!0,enableMassClear:this._enableMassClear});this._map.addOverlay(i),this._dots.push(i)},n.prototype._formatDisStr=function(t){var e=this._opts.unit,i=this._units[e].u1,n=this._convertUnit(t,e);return n>this._units[e].incon?(n/=this._units[e].incon,i=this._units[e].u2,n=n.toFixed(1)):n=n.toFixed(0),n+i},n.prototype._setCursor=function(t){var e=/webkit/.test(navigator.userAgent.toLowerCase())?"url("+this._opts.cursor+") 3 6, crosshair":"url("+this._opts.cursor+"), crosshair";o._setCursor(e)},n.prototype._getCursor=function(){return this._opts.cursor},n.prototype._formatSegLabel=function(t,e){t.setStyle({border:"none",padding:"0"}),t.setContent("<span style='"+this._styles.BMapLib_diso+"'><span style='"+this._styles.BMapLib_disi+"'>"+e+"</span></span>")},n.prototype._processLastOp=function(){var i=this;if(delete i._bind.x,delete i._bind.y,delete i._bind.initX,delete i._bind.initY,i._paths.length>i._points.length-1){var n=i._paths.length-1;i._paths[n].remove(),i._paths[n]=null,i._paths.length=n}var o={};o.points=i._points.slice(0),o.paths=i._paths.slice(0),o.dots=i._dots.slice(0),o.segDis=i._segDistance.slice(0);var s=i._map.pointToPixel(o.points[o.points.length-1]),a=i._map.pointToPixel(o.points[o.points.length-2]),r=[0,0],l=[0,0];l=s.y-a.y>=0?[-5,11]:[-5,-35],r=s.x-a.x>=0?[14,0]:[-14,0];var p=o.points[o.points.length-1];p.disLabel=new BMap.Label("",{offset:new BMap.Size(-15,-40),enableMassClear:i._enableMassClear}),p.disLabel.setStyles({color:"#333",borderColor:"#ff0103"}),i._map.addOverlay(p.disLabel),p.disLabel.setOffset(new BMap.Size(l[0],l[1])),p.disLabel.setPosition(p),i._formatTitle(2,"","",p.disLabel);var h=this._opts.closeIcon?this._opts.closeIcon:new BMap.Icon("http://api.map.baidu.com/images/mapctrls.gif",new BMap.Size(12,12),{imageOffset:new BMap.Size(0,-14)});o.closeBtn=new BMap.Marker(o.points[o.points.length-1],{icon:h,offset:new BMap.Size(r[0],r[1]),baseZIndex:36e5,enableMassClear:i._enableMassClear}),i._map.addOverlay(o.closeBtn),o.closeBtn.setTitle("清除本次测距"),o.closeBtn.addEventListener("click",function(n){for(var s=0,a=o.points.length;s<a;s++)o.points[s].disLabel.remove(),o.points[s].disLabel=null;for(var s=0,a=o.paths.length;s<a;s++)o.paths[s].remove(),o.paths[s]=null;for(var s=0,a=o.dots.length;s<a;s++)o.dots[s].remove(),o.dots[s]=null;o.closeBtn.remove(),o.closeBtn=null,t(n);var r=new e.lang.Event("onremovepolyline");i.dispatchEvent(r)}),i._initData()},n.prototype._formatTitle=function(t,e,i,n){var o=n||this._followTitle;if(o){o.setStyle({lineHeight:"16px",zIndex:"85",padding:"3px 5px"});var s=this._startFollowText||"",a=[];if(1==t){o.setOffset(0,25);var r=this._opts.unit,l=this._units[r].u1,p=this._convertUnit(i,r);p>this._units[r].incon?(p/=this._units[r].incon,l=this._units[r].u2,p=p.toFixed(1)):p=p.toFixed(0),a.push("<span>总长：<span style='"+this._styles.BMapLib_disBoxDis+"'>"+p+"</span>"+l+"</span><br />"),a.push("<span style='color:#7a7a7a'>"+e+"</span>")}else if(2==t){var r=this._opts.unit,l=this._units[r].u1,p=this._convertUnit(this._getTotalDistance(),r);p>this._units[r].incon?(p/=this._units[r].incon,l=this._units[r].u2,p=p.toFixed(1)):p=p.toFixed(0),a.push("总长：<span style='"+this._styles.BMapLib_disBoxDis+"'>"+p+"</span>"+l)}else o.setOffset(0,25),a.push(s);o.setContent(a.join(""))}},n.prototype._updateInstDis=function(t,e){var i=this._opts.unit,n=this._units[i].u1;if(e>this._units[i].incon?(e/=this._units[i].incon,n=this._units[i].u2,e=e.toFixed(1)):e=e.toFixed(0),t){var o=[];o.push("<span>总长：<span style='"+this._styles.BMapLib_disBoxDis+"'>"+e+"</span>"+n+"</span><br />"),o.push("<span style='color:#7a7a7a'>"+this._opts.followText+"</span>"),t.setContent(o.join(""))}},n.prototype._hideCurrent=function(){if(this._isOpen){if(this._paths.length>0){this._paths[this._paths.length-1].hide()}this._followTitle&&this._followTitle.hide()}},n.prototype._isPointValid=function(t){if(!t)return!1;var e=this._map.getBounds(),i=e.getSouthWest(),n=e.getNorthEast();return!(t.lng<i.lng||t.lng>n.lng||t.lat<i.lat||t.lat>n.lat)};var o={_map:null,_html:"<div style='background:transparent url(http://api.map.baidu.com/images/blank.gif);position:absolute;left:0;top:0;width:100%;height:100%;z-index:1000' unselectable='on'></div>",_maskElement:null,_cursor:"default",_inUse:!1,show:function(t){this._map||(this._map=t),this._inUse=!0,this._maskElement||this._createMask(t),this._maskElement.style.display="block"},_createMask:function(i){if(this._map=i,this._map){e.insertHTML(this._map.getContainer(),"beforeEnd",this._html);var n=this._maskElement=this._map.getContainer().lastChild,o=function(i){return t(i),e.preventDefault(i)};e.on(n,"mouseup",function(t){2==t.button&&o(t)}),e.on(n,"contextmenu",o),n.style.display="none"}},getDrawPoint:function(t,e){t=window.event||t;var i=t.layerX||t.offsetX||0,n=t.layerY||t.offsetY||0,s=t.target||t.srcElement;if(s!=o.getDom(this._map)&&1==e)for(;s&&s!=this._map.getContainer();)0==s.clientWidth&&0==s.clientHeight&&s.offsetParent&&"td"==s.offsetParent.nodeName.toLowerCase()||(i+=s.offsetLeft,n+=s.offsetTop),s=s.offsetParent;if(!(s!=o.getDom(this._map)&&s!=this._map.getContainer()||void 0===i||void 0===n||isNaN(i)||isNaN(n)))return this._map.pixelToPoint(new BMap.Pixel(i,n))},hide:function(){this._map&&(this._inUse=!1,this._maskElement&&(this._maskElement.style.display="none"))},getDom:function(t){return this._maskElement||this._createMask(t),this._maskElement},_setCursor:function(t){this._cursor=t||"default",this._maskElement&&(this._maskElement.style.cursor=this._cursor)}}}()},function(t,e){var i=window.BMapLib=i||{},n="marker",o="polyline",s="circle",a="rectangle",r="polygon";!function(){function t(){this._enableEdgeMove=!1}function e(t,e){this.drawingManager=t,e=this.drawingToolOptions=e||{},this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new BMap.Size(10,10),this.defaultDrawingModes=[n,s,o,r,a],e.drawingModes?this.drawingModes=e.drawingModes:this.drawingModes=this.defaultDrawingModes,e.anchor&&this.setAnchor(e.anchor),e.offset&&this.setOffset(e.offset)}function l(t){for(var e=c.length;e--;)c[e]!=t&&c[e].close()}var p=p||{guid:"$BAIDU$"};!function(){window[p.guid]={},p.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},p.lang=p.lang||{},p.lang.guid=function(){return"TANGRAM__"+(window[p.guid]._counter++).toString(36)},window[p.guid]._counter=window[p.guid]._counter||1,window[p.guid]._instances=window[p.guid]._instances||{},p.lang.Class=function(t){this.guid=t||p.lang.guid(),window[p.guid]._instances[this.guid]=this},window[p.guid]._instances=window[p.guid]._instances||{},p.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},p.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},p.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},p.lang.Class.prototype.dispose=function(){delete window[p.guid]._instances[this.guid];for(var t in this)p.lang.isFunction(this[t])||delete this[t];this.disposed=!0},p.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},p.lang.Class.prototype.addEventListener=function(t,e,i){if(p.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var n,o=this.__listeners;if("string"==typeof i&&i){if(/[^\w\-]/.test(i))throw"nonstandard key:"+i;e.hashCode=i,n=i}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof o[t]&&(o[t]={}),n=n||p.lang.guid(),e.hashCode=n,o[t][n]=e}},p.lang.Class.prototype.removeEventListener=function(t,e){if(p.lang.isFunction(e))e=e.hashCode;else if(!p.lang.isString(e))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var i=this.__listeners;i[t]&&i[t][e]&&delete i[t][e]},p.lang.Class.prototype.dispatchEvent=function(t,e){p.lang.isString(t)&&(t=new p.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{};for(var i in e)t[i]=e[i];var i,n=this.__listeners,o=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=o.indexOf("on")&&(o="on"+o),p.lang.isFunction(this[o])&&this[o].apply(this,arguments),"object"==typeof n[o])for(i in n[o])n[o][i].apply(this,arguments);return t.returnValue},p.lang.inherits=function(t,e,i){var n,o,s=t.prototype,a=new Function;a.prototype=e.prototype,o=t.prototype=new a;for(n in s)o[n]=s[n];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof i&&(o._className=i)},p.dom=p.dom||{},p._g=p.dom._g=function(t){return p.lang.isString(t)?document.getElementById(t):t},p.g=p.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},p.insertHTML=p.dom.insertHTML=function(t,e,i){t=p.dom.g(t);var n,o;return t.insertAdjacentHTML?t.insertAdjacentHTML(e,i):(n=t.ownerDocument.createRange(),e=e.toUpperCase(),"AFTERBEGIN"==e||"BEFOREEND"==e?(n.selectNodeContents(t),n.collapse("AFTERBEGIN"==e)):(o="BEFOREBEGIN"==e,n[o?"setStartBefore":"setEndAfter"](t),n.collapse(o)),n.insertNode(n.createContextualFragment(i))),t},p.ac=p.dom.addClass=function(t,e){t=p.dom.g(t);for(var i=e.split(/\s+/),n=t.className,o=" "+n+" ",s=0,a=i.length;s<a;s++)o.indexOf(" "+i[s]+" ")<0&&(n+=(n?" ":"")+i[s]);return t.className=n,t},p.event=p.event||{},p.event._listeners=p.event._listeners||[],p.on=p.event.on=function(t,e,i){e=e.replace(/^on/i,""),t=p._g(t);var n,o=function(e){i.call(t,e)},s=p.event._listeners,a=p.event._eventFilter,r=e;return e=e.toLowerCase(),a&&a[e]&&(n=a[e](t,e,o),r=n.type,o=n.listener),t.addEventListener?t.addEventListener(r,o,!1):t.attachEvent&&t.attachEvent("on"+r,o),s[s.length]=[t,e,i,o,r],t},p.un=p.event.un=function(t,e,i){t=p._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var n,o,s,a=p.event._listeners,r=a.length,l=!i;r--;)n=a[r],n[1]!==e||n[0]!==t||!l&&n[2]!==i||(o=n[4],s=n[3],t.removeEventListener?t.removeEventListener(o,s,!1):t.detachEvent&&t.detachEvent("on"+o,s),a.splice(r,1));return t},p.getEvent=p.event.getEvent=function(t){return window.event||t},p.getTarget=p.event.getTarget=function(t){var t=p.getEvent(t);return t.target||t.srcElement},p.preventDefault=p.event.preventDefault=function(t){var t=p.getEvent(t);t.preventDefault?t.preventDefault():t.returnValue=!1},p.stopBubble=p.event.stopBubble=function(t){t=p.getEvent(t),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},p.browser=p.browser||{},/msie (\d+\.\d)/i.test(navigator.userAgent)&&(p.browser.ie=p.ie=document.documentMode||+RegExp.$1)}();var h=i.DrawingManager=function(t,e){t&&(c.push(this),e=e||{},this._initialize(t,e))};p.lang.inherits(h,p.lang.Class,"DrawingManager"),h.prototype.open=function(){if(1==this._isOpen)return!0;l(this),this._open()},h.prototype.close=function(){if(0==this._isOpen)return!0;var t=this;this._close(),setTimeout(function(){t._map.enableDoubleClickZoom()},2e3)},h.prototype.setDrawingMode=function(t){this._drawingType!=t&&(l(this),this._setDrawingMode(t))},h.prototype.getDrawingMode=function(){return this._drawingType},h.prototype.enableCalculate=function(){this._enableCalculate=!0,this._addGeoUtilsLibrary()},h.prototype.disableCalculate=function(){this._enableCalculate=!1},h.prototype._initialize=function(t,i){if(this._map=t,this._opts=i,this._drawingType=i.drawingMode||n,i.enableDrawingTool){var o=new e(this,i.drawingToolOptions);this._drawingTool=o,t.addControl(o)}i.enableCalculate===!0?this.enableCalculate():this.disableCalculate(),this._isOpen=!(i.isOpen!==!0),this._isOpen&&this._open(),this.markerOptions=i.markerOptions||{},this.circleOptions=i.circleOptions||{},this.polylineOptions=i.polylineOptions||{},this.polygonOptions=i.polygonOptions||{},this.rectangleOptions=i.rectangleOptions||{},this.controlButton="right"==i.controlButton?"right":"left"},h.prototype._open=function(){this._isOpen=!0,this._mask||(this._mask=new t),this._map.addOverlay(this._mask),this._setDrawingMode(this._drawingType)},h.prototype._setDrawingMode=function(t){if(this._drawingType=t,this._isOpen)switch(this._mask.__listeners={},t){case n:this._bindMarker();break;case s:this._bindCircle();break;case o:case r:this._bindPolylineOrPolygon();break;case a:this._bindRectangle()}this._drawingTool&&this._isOpen&&this._drawingTool.setStyleByDrawingMode(t)},h.prototype._close=function(){this._isOpen=!1,this._mask&&this._map.removeOverlay(this._mask),this._drawingTool&&this._drawingTool.setStyleByDrawingMode("hander")},h.prototype._bindMarker=function(){var t=this,e=this._map,i=this._mask,n=function(i){var n=new BMap.Marker(i.point,t.markerOptions);e.addOverlay(n),t._dispatchOverlayComplete(n)};i.addEventListener("click",n)},h.prototype._bindCircle=function(){var t=this,e=this._map,i=this._mask,n=null,o=null,s=function(s){("right"!=t.controlButton||1!=s.button&&0!=s.button)&&(o=s.point,n=new BMap.Circle(o,0,t.circleOptions),e.addOverlay(n),i.enableEdgeMove(),i.addEventListener("mousemove",a),p.on(document,"mouseup",r))},a=function(e){n.setRadius(t._map.getDistance(o,e.point))},r=function(e){var s=t._calculate(n,e.point);t._dispatchOverlayComplete(n,s),o=null,i.disableEdgeMove(),i.removeEventListener("mousemove",a),p.un(document,"mouseup",r)},l=function(e){p.preventDefault(e),p.stopBubble(e),"right"==t.controlButton&&1==e.button||null==o&&s(e)};i.addEventListener("mousedown",l)},h.prototype._bindPolylineOrPolygon=function(){var t=this,e=this._map,i=this._mask,n=[],s=null;overlay=null,isBinded=!1;var a=function(a){("right"!=t.controlButton||1!=a.button&&0!=a.button)&&(n.push(a.point),s=n.concat(n[n.length-1]),1==n.length?(t._drawingType==o?overlay=new BMap.Polyline(s,t.polylineOptions):t._drawingType==r&&(overlay=new BMap.Polygon(s,t.polygonOptions)),e.addOverlay(overlay)):overlay.setPath(s),isBinded||(isBinded=!0,i.enableEdgeMove(),i.addEventListener("mousemove",l),i.addEventListener("dblclick",h)))},l=function(t){overlay.setPositionAt(s.length-1,t.point)},h=function(e){p.stopBubble(e),isBinded=!1,i.disableEdgeMove(),i.removeEventListener("mousedown",a),i.removeEventListener("mousemove",l),i.removeEventListener("dblclick",h),"right"==t.controlButton?n.push(e.point):p.ie<=8||n.pop(),overlay.setPath(n);var o=t._calculate(overlay,n.pop());t._dispatchOverlayComplete(overlay,o),n.length=0,s.length=0,t.close()};i.addEventListener("mousedown",a),i.addEventListener("dblclick",function(t){p.stopBubble(t)})},h.prototype._bindRectangle=function(){var t=this,e=this._map,i=this._mask,n=null,o=null,s=function(s){if(p.stopBubble(s),p.preventDefault(s),"right"!=t.controlButton||1!=s.button&&0!=s.button){o=s.point;var l=o;n=new BMap.Polygon(t._getRectanglePoint(o,l),t.rectangleOptions),e.addOverlay(n),i.enableEdgeMove(),i.addEventListener("mousemove",a),p.on(document,"mouseup",r)}},a=function(e){n.setPath(t._getRectanglePoint(o,e.point))},r=function(e){var s=t._calculate(n,n.getPath()[2]);t._dispatchOverlayComplete(n,s),o=null,i.disableEdgeMove(),i.removeEventListener("mousemove",a),p.un(document,"mouseup",r)};i.addEventListener("mousedown",s)},h.prototype._calculate=function(t,e){var n={data:0,label:null};if(this._enableCalculate&&i.GeoUtils){switch(t.toString()){case"[object Polyline]":n.data=i.GeoUtils.getPolylineDistance(t);break;case"[object Polygon]":n.data=i.GeoUtils.getPolygonArea(t);break;case"[object Circle]":var o=t.getRadius();n.data=Math.PI*o*o}!n.data||n.data<0?n.data=0:n.data=n.data.toFixed(2),n.label=this._addLabel(e,n.data)}return n},h.prototype._addGeoUtilsLibrary=function(){if(!i.GeoUtils){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js"),document.body.appendChild(t)}},h.prototype._addLabel=function(t,e){var i=new BMap.Label(e,{position:t});return this._map.addOverlay(i),i},h.prototype._getRectanglePoint=function(t,e){return[new BMap.Point(t.lng,t.lat),new BMap.Point(e.lng,t.lat),new BMap.Point(e.lng,e.lat),new BMap.Point(t.lng,e.lat)]},h.prototype._dispatchOverlayComplete=function(t,e){var i={overlay:t,drawingMode:this._drawingType};e&&(i.calculate=e.data||null,i.label=e.label||null),this.dispatchEvent(this._drawingType+"complete",t),this.dispatchEvent("overlaycomplete",i)},t.prototype=new BMap.Overlay,t.prototype.dispatchEvent=p.lang.Class.prototype.dispatchEvent,t.prototype.addEventListener=p.lang.Class.prototype.addEventListener,t.prototype.removeEventListener=p.lang.Class.prototype.removeEventListener,t.prototype.initialize=function(t){var e=this;this._map=t;var i=this.container=document.createElement("div"),n=this._map.getSize();return i.style.cssText="position:absolute;background:url(about:blank);cursor:crosshair;width:"+n.width+"px;height:"+n.height+"px",this._map.addEventListener("resize",function(t){e._adjustSize(t.size)}),this._map.getPanes().floatPane.appendChild(i),this._bind(),i},t.prototype.draw=function(){var t=this._map,e=t.pixelToPoint(new BMap.Pixel(0,0)),i=t.pointToOverlayPixel(e);this.container.style.left=i.x+"px",this.container.style.top=i.y+"px"},t.prototype.enableEdgeMove=function(){this._enableEdgeMove=!0},t.prototype.disableEdgeMove=function(){clearInterval(this._edgeMoveTimer),this._enableEdgeMove=!1},t.prototype._bind=function(){for(var t=this,e=(this._map,this.container),i=null,n=null,o=function(t){return{x:t.clientX,y:t.clientY}},s=function(e){var s=e.type;e=p.getEvent(e),point=t.getDrawPoint(e);var a=function(i){e.point=point,t.dispatchEvent(e)};"mousedown"==s&&(i=o(e));var r=o(e);"click"==s?Math.abs(r.x-i.x)<5&&Math.abs(r.y-i.y)<5&&(n&&Math.abs(r.x-n.x)<5&&Math.abs(r.y-n.y)<5?n=null:(a(),n=o(e))):a()},a=["click","mousedown","mousemove","mouseup","dblclick"],r=a.length;r--;)p.on(e,a[r],s);p.on(e,"mousemove",function(e){t._enableEdgeMove&&t.mousemoveAction(e)})},t.prototype.mousemoveAction=function(t){var e=this._map,i=this,n=e.pointToPixel(this.getDrawPoint(t)),o=function(t){var e=t.clientX,i=t.clientY;return t.changedTouches&&(e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY),new BMap.Pixel(e,i)}(t),s=o.x-n.x,a=o.y-n.y;n=new BMap.Pixel(o.x-s,o.y-a),this._draggingMovePixel=n;e.pixelToPoint(n);this._panByX=this._panByY=0,n.x<=20||n.x>=e.width-20||n.y<=50||n.y>=e.height-10?(n.x<=20?this._panByX=8:n.x>=e.width-20&&(this._panByX=-8),n.y<=50?this._panByY=8:n.y>=e.height-10&&(this._panByY=-8),this._edgeMoveTimer||(this._edgeMoveTimer=setInterval(function(){e.panBy(i._panByX,i._panByY,{noAnimation:!0})},30))):this._edgeMoveTimer&&(clearInterval(this._edgeMoveTimer),this._edgeMoveTimer=null)},t.prototype._adjustSize=function(t){this.container.style.width=t.width+"px",this.container.style.height=t.height+"px"},t.prototype.getDrawPoint=function(t){var e=this._map,i=p.getTarget(t),n=t.offsetX||t.layerX||0,o=t.offsetY||t.layerY||0;for(1!=i.nodeType&&(i=i.parentNode);i&&i!=e.getContainer();)0==i.clientWidth&&0==i.clientHeight&&i.offsetParent&&"TD"==i.offsetParent.nodeName||(n+=i.offsetLeft||0,o+=i.offsetTop||0),i=i.offsetParent;var s=new BMap.Pixel(n,o);return e.pixelToPoint(s)},e.prototype=new BMap.Control,e.prototype.initialize=function(t){var e=this.container=document.createElement("div");e.className="BMapLib_Drawing";var i=this.panel=document.createElement("div");return i.className="BMapLib_Drawing_panel",this.drawingToolOptions&&this.drawingToolOptions.scale&&this._setScale(this.drawingToolOptions.scale),e.appendChild(i),i.innerHTML=this._generalHtml(),this._bind(i),t.getContainer().appendChild(e),e},e.prototype._generalHtml=function(t){var e={};e.hander="拖动地图",e[n]="画点",e[s]="画圆",e[o]="画折线",e[r]="画多边形",e[a]="画矩形";var i=function(t,i){return'<a class="'+t+'" drawingType="'+i+'" href="javascript:void(0)" title="'+e[i]+'" onfocus="this.blur()"></a>'},l=[];l.push(i("BMapLib_box BMapLib_hander","hander"));for(var p=0,h=this.drawingModes.length;p<h;p++){var c="BMapLib_box BMapLib_"+this.drawingModes[p];p==h-1&&(c+=" BMapLib_last"),l.push(i(c,this.drawingModes[p]))}return l.join("")},e.prototype._setScale=function(t){var e=-parseInt((390-390*t)/2,10),i=-parseInt((50-50*t)/2,10);this.container.style.cssText=["-moz-transform: scale("+t+");","-o-transform: scale("+t+");","-webkit-transform: scale("+t+");","transform: scale("+t+");","margin-left:"+e+"px;","margin-top:"+i+"px;","*margin-left:0px;","*margin-top:0px;","margin-left:0px\\0;","margin-top:0px\\0;","filter: progid:DXImageTransform.Microsoft.Matrix(","M11="+t+",","M12=0,","M21=0,","M22="+t+",","SizingMethod='auto expand');"].join("")},e.prototype._bind=function(t){var e=this;p.on(this.panel,"click",function(t){var i=p.getTarget(t),n=i.getAttribute("drawingType");e.setStyleByDrawingMode(n),e._bindEventByDraingMode(n)})},e.prototype.setStyleByDrawingMode=function(t){if(t)for(var e=this.panel.getElementsByTagName("a"),i=0,n=e.length;i<n;i++){var o=e[i];if(o.getAttribute("drawingType")==t){var s="BMapLib_box BMapLib_"+t+"_hover";i==n-1&&(s+=" BMapLib_last"),o.className=s}else o.className=o.className.replace(/_hover/,"")}},e.prototype._bindEventByDraingMode=function(t){var e=this.drawingManager;"hander"==t?(e.close(),e._map.enableDoubleClickZoom()):(e.setDrawingMode(t),e.open(),e._map.disableDoubleClickZoom())};var c=[]}()},function(t,e){window.BMapLib=window.BMapLib||{},window.BMapLib.EventWrapper=window.BMapLib.EventWrapper||{},function(){function t(e,i,n,o){this._instance=e,this._eventName=i,this._handler=n,this._eventType=o,this._guid=t._guid++,this._instance._e_=this._instance._e_||{},this._instance._e_[this._guid]=this}var e=window.BMapLib.EventWrapper;e.addDomListener=function(e,i,n){return e.addEventListener?e.addEventListener(i,n,!1):e.attachEvent?e.attachEvent("on"+i,n):e["on"+i]=n,new t(e,i,n,t.DOM_EVENT)},e.addDomListenerOnce=function(t,i,n){var o=e.addDomListener(t,i,function(){return e.removeListener(o),n.apply(this,arguments)});return o},e.addListener=function(e,i,n){return e.addEventListener(i,n),new t(e,i,n,t.MAP_EVENT)},e.addListenerOnce=function(t,i,n){var o=e.addListener(t,i,function(){return e.removeListener(o),n.apply(this,arguments)});return o},e.clearInstanceListeners=function(t){var i=t._e_||{};for(var n in i)e.removeListener(i[n]);t._e_={}},e.clearListeners=function(t,i){var n=t._e_||{};for(var o in n)n[o]._eventName==i&&e.removeListener(n[o])},e.removeListener=function(e){var i=e._instance,n=e._eventName,o=e._handler,s=i._e_||{};for(var a in s)s[a]._guid==e._guid&&(e._eventType==t.DOM_EVENT?i.removeEventListener?i.removeEventListener(n,o,!1):i.detachEvent?i.detachEvent("on"+n,o):i["on"+n]=null:e._eventType==t.MAP_EVENT&&i.removeEventListener(n,o),delete s[a])},e.trigger=function(t,e){var i=t._e_||{};for(var n in i)if(i[n]._eventName==e){var o=Array.prototype.slice.call(arguments,2);i[n]._handler.apply(t,o)}},t._guid=1,t.DOM_EVENT=1,t.MAP_EVENT=2}()},function(t,e){var i=window.BMapLib=i||{};!function(){function t(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t}function e(t,e,i){for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t}var n=i.GeoUtils=function(){};n.isPointInRect=function(t,e){if(!(t instanceof BMap.Point&&e instanceof BMap.Bounds))return!1;var i=e.getSouthWest(),n=e.getNorthEast();return t.lng>=i.lng&&t.lng<=n.lng&&t.lat>=i.lat&&t.lat<=n.lat},n.isPointInCircle=function(t,e){if(!(t instanceof BMap.Point&&e instanceof BMap.Circle))return!1;var i=e.getCenter(),o=e.getRadius();return n.getDistance(t,i)<=o},n.isPointOnPolyline=function(t,e){if(!(t instanceof BMap.Point&&e instanceof BMap.Polyline))return!1;var i=e.getBounds();if(!this.isPointInRect(t,i))return!1;for(var n=e.getPath(),o=0;o<n.length-1;o++){var s=n[o],a=n[o+1];if(t.lng>=Math.min(s.lng,a.lng)&&t.lng<=Math.max(s.lng,a.lng)&&t.lat>=Math.min(s.lat,a.lat)&&t.lat<=Math.max(s.lat,a.lat)){var r=(s.lng-t.lng)*(a.lat-t.lat)-(a.lng-t.lng)*(s.lat-t.lat);if(r<2e-10&&r>-2e-10)return!0}}return!1},n.isPointInPolygon=function(t,e){if(!(t instanceof BMap.Point&&e instanceof BMap.Polygon))return!1;var i=e.getBounds();if(!this.isPointInRect(t,i))return!1;var n,o,s=e.getPath(),a=s.length,r=0,l=t;n=s[0];for(var p=1;p<=a;++p){if(l.equals(n))return!0;if(o=s[p%a],l.lat<Math.min(n.lat,o.lat)||l.lat>Math.max(n.lat,o.lat))n=o;else{if(l.lat>Math.min(n.lat,o.lat)&&l.lat<Math.max(n.lat,o.lat)){if(l.lng<=Math.max(n.lng,o.lng)){if(n.lat==o.lat&&l.lng>=Math.min(n.lng,o.lng))return!0;if(n.lng==o.lng){if(n.lng==l.lng)return!0;++r}else{var h=(l.lat-n.lat)*(o.lng-n.lng)/(o.lat-n.lat)+n.lng;if(Math.abs(l.lng-h)<2e-10)return!0;l.lng<h&&++r}}}else if(l.lat==o.lat&&l.lng<=o.lng){var c=s[(p+1)%a];l.lat>=Math.min(n.lat,c.lat)&&l.lat<=Math.max(n.lat,c.lat)?++r:r+=2}n=o}}return r%2!=0},n.degreeToRad=function(t){return Math.PI*t/180},n.radToDegree=function(t){return 180*t/Math.PI},n.getDistance=function(i,o){if(!(i instanceof BMap.Point&&o instanceof BMap.Point))return 0;i.lng=e(i.lng,-180,180),i.lat=t(i.lat,-74,74),o.lng=e(o.lng,-180,180),o.lat=t(o.lat,-74,74);var s,a,r,l;return s=n.degreeToRad(i.lng),r=n.degreeToRad(i.lat),a=n.degreeToRad(o.lng),l=n.degreeToRad(o.lat),6370996.81*Math.acos(Math.sin(r)*Math.sin(l)+Math.cos(r)*Math.cos(l)*Math.cos(a-s))},n.getPolylineDistance=function(t){if(t instanceof BMap.Polyline||t instanceof Array){var e;if(e=t instanceof BMap.Polyline?t.getPath():t,e.length<2)return 0;for(var i=0,o=0;o<e.length-1;o++){var s=e[o],a=e[o+1];i+=n.getDistance(s,a)}return i}return 0},n.getPolygonArea=function(t){if(!(t instanceof BMap.Polygon||t instanceof Array))return 0;var e;if(e=t instanceof BMap.Polygon?t.getPath():t,e.length<3)return 0;for(var i=0,n=0,o=0,s=0,a=0,r=0,l=0,p=0,h=0,c=0,d=0,_=0,u=0,g=0,f=0,m=0,v=0,b=0,y=0,w=0,M=0,B=0,x=0,T=0,L=0,C=0,k=0,S=0,E=0,P=0,I=0,O=0,D=0,A=e.length,N=0;N<A;N++)0==N?(i=e[A-1].lng*Math.PI/180,n=e[A-1].lat*Math.PI/180,o=e[0].lng*Math.PI/180,s=e[0].lat*Math.PI/180,a=e[1].lng*Math.PI/180,r=e[1].lat*Math.PI/180):N==A-1?(i=e[A-2].lng*Math.PI/180,n=e[A-2].lat*Math.PI/180,o=e[A-1].lng*Math.PI/180,s=e[A-1].lat*Math.PI/180,a=e[0].lng*Math.PI/180,r=e[0].lat*Math.PI/180):(i=e[N-1].lng*Math.PI/180,n=e[N-1].lat*Math.PI/180,o=e[N].lng*Math.PI/180,s=e[N].lat*Math.PI/180,a=e[N+1].lng*Math.PI/180,r=e[N+1].lat*Math.PI/180),l=Math.cos(s)*Math.cos(o),p=Math.cos(s)*Math.sin(o),h=Math.sin(s),c=Math.cos(n)*Math.cos(i),d=Math.cos(n)*Math.sin(i),_=Math.sin(n),u=Math.cos(r)*Math.cos(a),g=Math.cos(r)*Math.sin(a),f=Math.sin(r),m=(l*l+p*p+h*h)/(l*c+p*d+h*_),v=(l*l+p*p+h*h)/(l*u+p*g+h*f),b=m*c-l,y=m*d-p,w=m*_-h,M=v*u-l,B=v*g-p,x=v*f-h,S=(M*b+B*y+x*w)/(Math.sqrt(M*M+B*B+x*x)*Math.sqrt(b*b+y*y+w*w)),S=Math.acos(S),T=B*w-x*y,L=0-(M*w-x*b),C=M*y-B*b,k=0!=l?T/l:0!=p?L/p:C/h,k>0?(E+=S,O++):(P+=S,I++);var z,R;return z=E+(2*Math.PI*I-P),R=2*Math.PI*O-E+P,D=E>P?z-(A-2)*Math.PI<1?z:R:R-(A-2)*Math.PI<1?R:z,6370996.81*(D-(A-2)*Math.PI)*6370996.81}}()},function(t,e){var i=window.BMapLib=i||{};!function(){var t,e=t=e||{version:"1.5.0"};e.guid="$BAIDU$",function(){window[e.guid]=window[e.guid]||{},e.lang=e.lang||{},e.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},e.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},e.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},e.object=e.object||{},e.extend=e.object.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},e.event=e.event||{},e.event._listeners=e.event._listeners||[],e.dom=e.dom||{},e.dom._g=function(t){return e.lang.isString(t)?document.getElementById(t):t},e._g=e.dom._g,e.event.on=function(t,i,n){i=i.replace(/^on/i,""),t=e.dom._g(t);var o,s=function(e){n.call(t,e)},a=e.event._listeners,r=e.event._eventFilter,l=i;return i=i.toLowerCase(),r&&r[i]&&(o=r[i](t,i,s),l=o.type,s=o.listener),t.addEventListener?t.addEventListener(l,s,!1):t.attachEvent&&t.attachEvent("on"+l,s),a[a.length]=[t,i,n,s,l],t},e.on=e.event.on,e.event.un=function(t,i,n){t=e.dom._g(t),i=i.replace(/^on/i,"").toLowerCase();for(var o,s,a,r=e.event._listeners,l=r.length,p=!n;l--;)o=r[l],o[1]!==i||o[0]!==t||!p&&o[2]!==n||(s=o[4],a=o[3],t.removeEventListener?t.removeEventListener(s,a,!1):t.detachEvent&&t.detachEvent("on"+s,a),r.splice(l,1));return t},e.un=e.event.un,e.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},e.g=e.G=e.dom.g,e.dom._styleFixer=e.dom._styleFixer||{},e.dom._styleFilter=e.dom._styleFilter||[],e.dom._styleFilter.filter=function(t,i,n){for(var o,s=0,a=e.dom._styleFilter;o=a[s];s++)(o=o[n])&&(i=o(t,i));return i},e.string=e.string||{},e.string.toCamelCase=function(t){return t.indexOf("-")<0&&t.indexOf("_")<0?t:t.replace(/[-_][^-_]/g,function(t){return t.charAt(1).toUpperCase()})},e.dom.setStyle=function(t,i,n){var o,s=e.dom;return t=s.g(t),i=e.string.toCamelCase(i),(o=s._styleFilter)&&(n=o.filter(i,n,"set")),o=s._styleFixer[i],o&&o.set?o.set(t,n):t.style[o||i]=n,t},e.setStyle=e.dom.setStyle,e.dom.setStyles=function(t,i){t=e.dom.g(t);for(var n in i)e.dom.setStyle(t,n,i[n]);return t},e.setStyles=e.dom.setStyles,e.browser=e.browser||{},e.browser.ie=e.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,e.dom._NAME_ATTRS=function(){var t={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};return e.browser.ie<8?(t.for="htmlFor",t.class="className"):(t.htmlFor="for",t.className="class"),t}(),e.dom.setAttr=function(t,i,n){return t=e.dom.g(t),"style"==i?t.style.cssText=n:(i=e.dom._NAME_ATTRS[i]||i,t.setAttribute(i,n)),t},e.setAttr=e.dom.setAttr,e.dom.setAttrs=function(t,i){t=e.dom.g(t);for(var n in i)e.dom.setAttr(t,n,i[n]);return t},e.setAttrs=e.dom.setAttrs,e.dom.create=function(t,i){var n=document.createElement(t),o=i||{};return e.dom.setAttrs(n,o)},t.undope=!0}();var n=i.InfoBox=function(t,e,i){this._content=e||"",this._isOpen=!1,this._map=t,this._opts=i=i||{},this._opts.offset=i.offset||new BMap.Size(0,0),this._opts.boxClass=i.boxClass||"infoBox",this._opts.boxStyle=i.boxStyle||{},this._opts.closeIconMargin=i.closeIconMargin||"2px",this._opts.closeIconUrl=i.closeIconUrl||"close.png",this._opts.enableAutoPan=!!i.enableAutoPan,this._opts.align=i.align||1};n.prototype=new BMap.Overlay,n.prototype.initialize=function(t){var i=this,n=this._div=e.dom.create("div",{class:this._opts.boxClass});e.dom.setStyles(n,this._opts.boxStyle),n.style.position="absolute",this._setContent(this._content);var o=t.getPanes().floatPane;return o.style.width="auto",o.appendChild(n),this._getInfoBoxSize(),e.event.on(n,"onmousedown",function(t){i._stopBubble(t)}),e.event.on(n,"onmouseover",function(t){i._stopBubble(t)}),e.event.on(n,"click",function(t){i._stopBubble(t)}),e.event.on(n,"dblclick",function(t){i._stopBubble(t)}),n},n.prototype.draw=function(){this._isOpen&&this._adjustPosition(this._point)},n.prototype.open=function(t){var e,i=this;this._isOpen||(this._map.addOverlay(this),this._isOpen=!0,setTimeout(function(){i._dispatchEvent(i,"open",{point:i._point})},10)),t instanceof BMap.Point?(e=t,this._removeMarkerEvt()):t instanceof BMap.Marker&&(this._marker&&this._removeMarkerEvt(),e=t.getPosition(),this._marker=t,!this._markerDragend&&this._marker.addEventListener("dragend",this._markerDragend=function(t){i._point=t.point,i._adjustPosition(i._point),i._panBox(),i.show()}),!this._markerDragging&&this._marker.addEventListener("dragging",this._markerDragging=function(){i.hide(),i._point=i._marker.getPosition(),i._adjustPosition(i._point)})),this.show(),this._point=e,this._panBox(),this._adjustPosition(this._point)},n.prototype.close=function(){this._isOpen&&(this._map.removeOverlay(this),this._remove(),this._isOpen=!1,this._dispatchEvent(this,"close",{point:this._point}))},n.prototype.enableAutoPan=function(){this._opts.enableAutoPan=!0},n.prototype.disableAutoPan=function(){this._opts.enableAutoPan=!1},n.prototype.setContent=function(t){this._setContent(t),this._getInfoBoxSize(),this._adjustPosition(this._point)},n.prototype.setPosition=function(t){this._point=t,this._adjustPosition(t),this._removeMarkerEvt()},n.prototype.getPosition=function(){return this._point},n.prototype.getOffset=function(){return this._opts.offset},n.prototype._remove=function(){var t=this;this.domElement&&this.domElement.parentNode&&(e.event.un(this._div.firstChild,"click",t._closeHandler()),this.domElement.parentNode.removeChild(this.domElement)),this.domElement=null,this._isOpen=!1,this.dispatchEvent("onremove")},e.object.extend(n.prototype,{_getCloseIcon:function(){return"<img src='"+this._opts.closeIconUrl+"' align='right' style='position:absolute;right:0px;cursor:pointer;margin:"+this._opts.closeIconMargin+"'/>"},_setContent:function(t){if(this._div){var e=this._getCloseIcon();void 0===t.nodeType?this._div.innerHTML=e+t:(this._div.innerHTML=e,this._div.appendChild(t)),this._content=t,this._addEventToClose()}},_adjustPosition:function(t){var e=this._getPointPosition(t),i=this._marker&&this._marker.getIcon();switch(this._opts.align){case 1:this._marker?this._div.style.bottom=-(e.y-this._opts.offset.height-i.anchor.height+i.infoWindowAnchor.height)-this._marker.getOffset().height+2+"px":this._div.style.bottom=-(e.y-this._opts.offset.height)+"px";break;case 3:this._marker?this._div.style.top=e.y+this._opts.offset.height-i.anchor.height+i.infoWindowAnchor.height+this._marker.getOffset().height+"px":this._div.style.top=e.y+this._opts.offset.height+"px"}this._marker?this._div.style.left=e.x-i.anchor.width+this._marker.getOffset().width+i.infoWindowAnchor.width-this._boxWidth/2+"px":this._div.style.left=e.x-this._boxWidth/2+"px"},_getPointPosition:function(t){return this._pointPosition=this._map.pointToOverlayPixel(t),this._pointPosition},_getInfoBoxSize:function(){this._boxWidth=parseInt(this._div.offsetWidth,10),this._boxHeight=parseInt(this._div.offsetHeight,10)},_addEventToClose:function(){var t=this;e.event.on(this._div.firstChild,"click",t._closeHandler()),this._hasBindEventClose=!0},_closeHandler:function(){var t=this;return function(e){t.close()}},_stopBubble:function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},_panBox:function(){if(this._opts.enableAutoPan){var t=parseInt(this._map.getContainer().offsetHeight,10),e=parseInt(this._map.getContainer().offsetWidth,10),i=this._boxHeight,n=this._boxWidth;if(!(i>=t||n>=e)){this._map.getBounds().containsPoint(this._point)||this._map.setCenter(this._point);var o,s,a,r=this._map.pointToPixel(this._point),l=n/2-r.x,p=n/2+r.x-e;if(this._marker)var h=this._marker.getIcon();switch(this._opts.align){case 1:var c=this._marker?h.anchor.height+this._marker.getOffset().height-h.infoWindowAnchor.height:0;o=i-r.y+this._opts.offset.height+c+2;break;case 3:var c=this._marker?-h.anchor.height+h.infoWindowAnchor.height+this._marker.getOffset().height+this._opts.offset.height:0;s=i+r.y-t+c+4}panX=l>0?l:p>0?-p:0,a=o>0?o:s>0?-s:0,this._map.panBy(panX,a)}}},_removeMarkerEvt:function(){this._markerDragend&&this._marker.removeEventListener("dragend",this._markerDragend),this._markerDragging&&this._marker.removeEventListener("dragging",this._markerDragging),this._markerDragend=this._markerDragging=null},_dispatchEvent:function(t,i,n){0!=i.indexOf("on")&&(i="on"+i);var o=new e.lang.Event(i);if(n)for(var s in n)o[s]=n[s];t.dispatchEvent(o)}})}()},function(t,e){var i=window.BMapLib=i||{};!function(){var t,e=t=e||{version:"1.5.1"};e.guid="$BAIDU$",function(){window[e.guid]=window[e.guid]||{},e.object=e.object||{},e.extend=e.object.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},t.undope=!0}();var n=i.MarkerManager=function(t,e){this._opts=e||{},this._map=t,this._zoom=t.getZoom(),this._numMarkers=[],"number"==typeof e.maxZoom?this._opts.maxZoom=this._opts.maxZoom:this._opts.maxZoom=19,"number"==typeof e.borderPadding?this._opts.borderPadding=e.borderPadding:this._opts.borderPadding=0;var i=this;this._map.addEventListener("zoomend",function(){i._showMarkers()}),this._map.addEventListener("dragend",function(){i._showMarkers()})};n.prototype.addMarker=function(t,e,i){e=e&&e>0?e:1,i=i&&i<=19?i:this._opts.maxZoom,t.minZoom=e,t.maxZoom=i,t.bAdded=!1,this._numMarkers.push(t),t.enableDragging()},n.prototype.addMarkers=function(t,e,i){for(var n=t.length,o=n;o--;)this.addMarker(t[o],e,i)},n.prototype.removeMarker=function(t){t instanceof BMap.Marker&&(this._map.removeOverlay(t),this._removeMarkerFromArray(t))},n.prototype.getMarkerCount=function(t){for(var e=this._numMarkers.length,i=this._numMarkers,n=0,o=e;o--;)n=i[o].bInBounds&&i[o].minZoom<=t&&i[o].maxZoom>=t?++n:n;return this._visible?n:0},n.prototype.show=function(){for(var t=this._numMarkers.length,e=t;e--;)this._numMarkers[e].bInBounds&&this._numMarkers[e].show();this._visible=!0},n.prototype.hide=function(){for(var t=this._numMarkers.length,e=t;e--;)this._numMarkers[e].bInBounds&&this._numMarkers[e].hide();this._visible=!1},n.prototype.toggle=function(){this._visible?this.hide():this.show()},n.prototype.showMarkers=function(){this._visible=!0,this._showMarkers()},n.prototype.clearMarkers=function(){for(var t=this._numMarkers.length,e=t;e--;)this._numMarkers[e].bInBounds&&this._map.removeOverlay(this._numMarkers[e]);this._numMarkers.length=0},e.object.extend(n.prototype,{_showMarkers:function(){for(var t=this._numMarkers.length,e=this._map.getZoom(),i=this._numMarkers,n=this._getRealBounds(),o=t;o--;)n.containsPoint(i[o].getPosition())&&e>=i[o].minZoom&&e<=i[o].maxZoom?(i[o].bInBounds=!0,i[o].bAdded?this._visible&&i[o].show():(this._map.addOverlay(i[o]),!this._visible&&i[o].hide(),i[o].bAdded=!0)):i[o].bAdded&&(i[o].bInBounds=!1,i[o].hide())},_getRealBounds:function(){var t=this._map.getBounds(),e=this._map.pointToPixel(t.getSouthWest()),i=this._map.pointToPixel(t.getNorthEast()),n={x:e.x-this._opts.borderPadding,y:e.y+this._opts.borderPadding},o={x:i.x+this._opts.borderPadding,y:i.y-this._opts.borderPadding},s=this._map.pixelToPoint(n),a=this._map.pixelToPoint(o);return new BMap.Bounds(s,a)},_removeMarkerFromArray:function(t){var e=this._numMarkers.length,i=e,n=0;for(i=e;i--;)t===this._numMarkers[i]&&(this._numMarkers.splice(i--,1),n++);return n}})}()},function(t,e){var i=window.BMapLib=i||{};void 0===i._toolInUse&&(i._toolInUse=!1),function(){var t=t||{guid:"$BAIDU$"};!function(){window[t.guid]={},t.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},t.lang=t.lang||{},t.lang.guid=function(){return"TANGRAM__"+(window[t.guid]._counter++).toString(36)},window[t.guid]._counter=window[t.guid]._counter||1,window[t.guid]._instances=window[t.guid]._instances||{},t.lang.Class=function(e){this.guid=e||t.lang.guid(),window[t.guid]._instances[this.guid]=this},t.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},t.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},t.lang.Class.prototype.dispose=function(){delete window[t.guid]._instances[this.guid];for(var e in this)t.lang.isFunction(this[e])||delete this[e];this.disposed=!0},t.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},t.lang.Class.prototype.addEventListener=function(e,i,n){if(t.lang.isFunction(i)){!this.__listeners&&(this.__listeners={});var o,s=this.__listeners;if("string"==typeof n&&n){if(/[^\w\-]/.test(n))throw"nonstandard key:"+n;i.hashCode=n,o=n}0!=e.indexOf("on")&&(e="on"+e),"object"!=typeof s[e]&&(s[e]={}),o=o||t.lang.guid(),i.hashCode=o,s[e][o]=i}},t.lang.Class.prototype.removeEventListener=function(e,i){if(t.lang.isFunction(i))i=i.hashCode;else if(!t.lang.isString(i))return;!this.__listeners&&(this.__listeners={}),0!=e.indexOf("on")&&(e="on"+e);var n=this.__listeners;n[e]&&n[e][i]&&delete n[e][i]},t.lang.Class.prototype.dispatchEvent=function(e,i){t.lang.isString(e)&&(e=new t.lang.Event(e)),!this.__listeners&&(this.__listeners={}),i=i||{};for(var n in i)e[n]=i[n];var n,o=this.__listeners,s=e.type;if(e.target=e.target||this,e.currentTarget=this,0!=s.indexOf("on")&&(s="on"+s),t.lang.isFunction(this[s])&&this[s].apply(this,arguments),"object"==typeof o[s])for(n in o[s])o[s][n].apply(this,arguments);return e.returnValue},t.lang.inherits=function(t,e,i){var n,o,s=t.prototype,a=new Function;a.prototype=e.prototype,o=t.prototype=new a;for(n in s)o[n]=s[n];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof i&&(o._className=i)}}();var e=i.MarkerTool=function(i,n){t.lang.Class.call(this),this._map=i,this._opts={icon:e.SYS_ICONS[8],followText:"点击地图添加标注",autoClose:!0},t.extend(this._opts,n),this._isOpen=!1,this._opts.followText=this._checkStr(this._opts.followText),this._followMarker=null,this._followLabel=null};t.lang.inherits(e,t.lang.Class,"MarkerTool"),e.prototype.open=function(){return!!this._map&&(1==this._isOpen||!i._toolInUse&&(i._toolInUse=!0,this._isOpen=!0,this._binded||(this._bind(),this._binded=!0),this._followMarker||(this._followMarker=new BMap.Marker(this._map.getCenter(),{offset:new BMap.Size(-10,-10)}),this._map.addOverlay(this._followMarker),this._followMarker.setZIndex(1e3),this._followMarker.hide()),this._followLabel||(this._followLabel=new BMap.Label(this._opts.followText,{offset:new BMap.Size(20,0)})),this._preCursor=this._map.getDefaultCursor(),this._map.setDefaultCursor("url("+e.CUR_IMG+"), default"),!0))},e.prototype.close=function(){this._isOpen&&(this._map.removeEventListener("mousemove",this._mouseMoveHandler),this._map.removeEventListener("click",this._clickHandler),this._followMarker.hide(),this._map.setDefaultCursor(this._preCursor),i._toolInUse=!1,this._isOpen=!1,this._binded=!1)},e.prototype.setIcon=function(t){t&&t instanceof BMap.Icon&&(this._opts.icon=t)},e.prototype.getIcon=function(){return this._opts.icon},e.prototype._checkStr=function(t){return t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""},e.prototype._bind=function(){var e=this;e._isOpen&&(e._mouseMoveHandler=function(t){var i=t.point;e._followMarker.setIcon(e._opts.icon),e._followMarker.setPosition(i),e._followMarker.setLabel(e._followLabel),e._followMarker.show()},e._map.addEventListener("mousemove",e._mouseMoveHandler),e._clickHandler=function(i){var n=i.pixel,o=new BMap.Pixel(n.x-10,n.y-10),s=e._map.pixelToPoint(o),a=new BMap.Marker(s,{icon:e._opts.icon});e._map.addOverlay(a);var r=new t.lang.Event("onmarkend");r.marker=a,e.dispatchEvent(r),e._opts.autoClose&&e.close()},e._map.addEventListener("click",e._clickHandler))},e.CUR_IMG="http://api.map.baidu.com/library/MarkerTool/1.2/src/images/transparent.cur",e.ICON_IMG="http://api.map.baidu.com/library/MarkerTool/1.2/src/images/us_mk_icon.png",e.SYS_ICONS=[new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(0,0)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-23,0)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-46,0)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-69,0)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-92,0)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(6,21),imageOffset:new BMap.Size(-115,0)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(0,-21)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-23,-21)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-46,-21)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-69,-21)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-92,-21)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(23,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-115,-21)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(0,-46)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-23,-46)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-46,-46)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-69,-46)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-92,-46)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(21,21),{anchor:new BMap.Size(1,21),imageOffset:new BMap.Size(-115,-46)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(25,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(0,-67)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(25,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(-25,-67)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(24,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(-50,-67)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(25,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(-75,-67)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(25,25),{anchor:new BMap.Size(12,25),imageOffset:new BMap.Size(-100,-67)}),new BMap.Icon(e.ICON_IMG,new BMap.Size(19,25),{anchor:new BMap.Size(9,25),imageOffset:new BMap.Size(-125,-67)})]}()},function(t,e){var i=window.BMapLib=i||{};!function(){function t(t,e,i){0!=e.indexOf("on")&&(e="on"+e);var n=new o.lang.Event(e);if(i)for(var s in i)n[s]=i[s];t.dispatchEvent(n)}function e(t){if(t){var i=t.attributes,n="";if(i)for(var o=0,s=i.length;o<s;o++)n=i[o].name,"function"==typeof t[n]&&(t[n]=null);var a=t.childnodes;if(a)for(var o=0,s=a.length;o<s;o++)e(t.childnodes[o])}}function n(t){var t=window.event||t;return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,o.preventDefault(t)}var o=o||{guid:"$BAIDU$"};!function(){window[o.guid]={},o.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},o.lang=o.lang||{},o.lang.guid=function(){return"TANGRAM__"+(window[o.guid]._counter++).toString(36)},window[o.guid]._counter=window[o.guid]._counter||1,window[o.guid]._instances=window[o.guid]._instances||{},o.lang.Class=function(t){this.guid=t||o.lang.guid(),window[o.guid]._instances[this.guid]=this},window[o.guid]._instances=window[o.guid]._instances||{},o.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},o.isString=o.lang.isString,o.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},o.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},o.lang.Class.prototype.addEventListener=function(t,e,i){if(o.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var n,s=this.__listeners;if("string"==typeof i&&i){if(/[^\w\-]/.test(i))throw"nonstandard key:"+i;e.hashCode=i,n=i}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof s[t]&&(s[t]={}),n=n||o.lang.guid(),e.hashCode=n,s[t][n]=e}},o.lang.Class.prototype.removeEventListener=function(t,e){if(o.lang.isFunction(e))e=e.hashCode;else if(!o.lang.isString(e))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var i=this.__listeners;i[t]&&i[t][e]&&delete i[t][e]},o.lang.Class.prototype.dispatchEvent=function(t,e){o.lang.isString(t)&&(t=new o.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{};for(var i in e)t[i]=e[i];var i,n=this.__listeners,s=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=s.indexOf("on")&&(s="on"+s),o.lang.isFunction(this[s])&&this[s].apply(this,arguments),"object"==typeof n[s])for(i in n[s])n[s][i].apply(this,arguments);return t.returnValue},o.dom=o.dom||{},o.dom._g=function(t){return o.lang.isString(t)?document.getElementById(t):t},o._g=o.dom._g,o.event=o.event||{},o.event._listeners=o.event._listeners||[],o.event.on=function(t,e,i){e=e.replace(/^on/i,""),t=o.dom._g(t);var n,s=function(e){i.call(t,e)},a=o.event._listeners,r=o.event._eventFilter,l=e;return e=e.toLowerCase(),r&&r[e]&&(n=r[e](t,e,s),l=n.type,s=n.listener),t.addEventListener?t.addEventListener(l,s,!1):t.attachEvent&&t.attachEvent("on"+l,s),a[a.length]=[t,e,i,s,l],t},o.on=o.event.on,o.event.un=function(t,e,i){t=o.dom._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var n,s,a,r=o.event._listeners,l=r.length,p=!i;l--;)n=r[l],n[1]!==e||n[0]!==t||!p&&n[2]!==i||(s=n[4],a=n[3],t.removeEventListener?t.removeEventListener(s,a,!1):t.detachEvent&&t.detachEvent("on"+s,a),r.splice(l,1));return t},o.un=o.event.un,o.preventDefault=o.event.preventDefault=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}}();var s=i.RichMarker=function(t,e,i){t&&e&&e instanceof BMap.Point&&(this._map=null,this._content=t,this._position=e,this._container=null,this._size=null,i=i||{},this._opts=o.extend(o.extend(this._opts||{},{enableDragging:!1,anchor:new BMap.Size(0,0)}),i))};s.prototype=new BMap.Overlay,s.prototype.initialize=function(t){var e=this,i=e._container=document.createElement("div");return e._map=t,o.extend(i.style,{position:"absolute",zIndex:BMap.Overlay.getZIndex(e._position.lat),background:"#FFF",cursor:"pointer"}),t.getPanes().labelPane.appendChild(i),e._appendContent(),e._setEventDispath(),e._getContainerSize(),i},s.prototype.draw=function(){var t=this._map,e=this._opts.anchor,i=t.pointToOverlayPixel(this._position);this._container.style.left=i.x+e.width+"px",this._container.style.top=i.y+e.height+"px"},s.prototype.enableDragging=function(){this._opts.enableDragging=!0},s.prototype.disableDragging=function(){this._opts.enableDragging=!1},s.prototype.isDraggable=function(){return this._opts.enableDragging},s.prototype.getPosition=function(){return this._position},s.prototype.setPosition=function(t){!t instanceof BMap.Point||(this._position=t,this.draw())},s.prototype.getAnchor=function(){return this._opts.anchor},s.prototype.setAnchor=function(t){!t instanceof BMap.Size||(this._opts.anchor=t,this.draw())},s.prototype._appendContent=function(){var t=this._content;if("string"==typeof t){var e=document.createElement("DIV");if(e.innerHTML=t,1==e.childNodes.length)t=e.removeChild(e.firstChild);else{for(var i=document.createDocumentFragment();e.firstChild;)i.appendChild(e.firstChild);t=i}}this._container.innerHTML="",this._container.appendChild(t)},s.prototype.getContent=function(){return this._content},s.prototype.setContent=function(t){t&&(this._content=t,this._appendContent())},s.prototype._getContainerSize=function(){if(this._container){var t=this._container.offsetHeight,e=this._container.offsetWidth;this._size=new BMap.Size(e,t)}},s.prototype.getWidth=function(){if(this._size)return this._size.width},s.prototype.setWidth=function(t){this._container&&(this._container.style.width=t+"px",this._getContainerSize())},s.prototype.getHeight=function(){if(this._size)return this._size.height},s.prototype.setHeight=function(t){this._container&&(this._container.style.height=t+"px",this._getContainerSize())},s.prototype._setEventDispath=function(){function e(t){var t=window.event||t,e=t.pageX||t.clientX||0,n=t.pageY||t.clientY||0,o=new BMap.Pixel(e,n);return{pixel:o,point:i._map.pixelToPoint(o)}}var i=this,s=i._container,a=!1,r=null;o.on(s,"onclick",function(e){t(i,"onclick"),n(e)}),o.on(s,"ontouchend",function(e){t(i,"ontouchend"),t(i,"onclick"),n(e)}),o.on(s,"ondblclick",function(o){var s=e(o);t(i,"ondblclick",{point:s.point,pixel:s.pixel}),n(o)}),s.onmouseover=function(o){var s=e(o);t(i,"onmouseover",{point:s.point,pixel:s.pixel}),n(o)},s.onmouseout=function(o){var s=e(o);t(i,"onmouseout",{point:s.point,pixel:s.pixel}),n(o)};var l=function(h){var c=e(h);if(t(i,"onmouseup",{point:c.point,pixel:c.pixel}),i._container.releaseCapture?(o.un(s,"onmousemove",p),o.un(s,"onmouseup",l)):(o.un(window,"onmousemove",p),o.un(window,"onmouseup",l)),!i._opts.enableDragging)return void n(h);i._container.releaseCapture&&i._container.releaseCapture(),t(i,"ondragend",{point:c.point,pixel:c.pixel}),a=!1,r=null,i._setCursor("dragend"),i._container.style.MozUserSelect="",i._container.style.KhtmlUserSelect="",i._container.style.WebkitUserSelect="",i._container.unselectable="off",i._container.onselectstart=function(){},n(h)},p=function(o){if(i._opts.enableDragging&&a){var s=e(o),l=i._map.pointToPixel(i._position),p=s.pixel.x-r.x+l.x,h=s.pixel.y-r.y+l.y;r=s.pixel,i._position=i._map.pixelToPoint(new BMap.Pixel(p,h)),i.draw(),i._setCursor("dragging"),t(i,"ondragging",{point:s.point,pixel:s.pixel}),n(o)}};o.on(s,"onmousedown",function(h){var c=e(h);if(t(i,"onmousedown",{point:c.point,pixel:c.pixel}),i._container.setCapture?(o.on(s,"onmousemove",p),o.on(s,"onmouseup",l)):(o.on(window,"onmousemove",p),o.on(window,"onmouseup",l)),!i._opts.enableDragging)return void n(h);r=c.pixel,t(i,"ondragstart",{point:c.point,pixel:c.pixel}),a=!0,i._setCursor("dragstart"),i._container.setCapture&&i._container.setCapture(),i._container.style.MozUserSelect="none",i._container.style.KhtmlUserSelect="none",i._container.style.WebkitUserSelect="none",i._container.unselectable="on",i._container.onselectstart=function(){return!1},n(h)})},s.prototype._setCursor=function(t){var e="",i={moz:{dragstart:"-moz-grab",dragging:"-moz-grabbing",dragend:"pointer"},other:{dragstart:"move",dragging:"move",dragend:"pointer"}};e=navigator.userAgent.indexOf("Gecko/")!==-1?i.moz[t]:i.other[t],this._container.style.cursor!=e&&(this._container.style.cursor=e)},s.prototype.remove=function(){t(this,"onremove"),this._container&&e(this._container),this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container)}}()},function(t,e,i){var n=window.BMapLib=n||{};!function(){function t(t,e){this._point=t,this.guid=e}function e(t){this.iw=t}function i(t){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",t),e.addEventListener?e.addEventListener("load",function(t){var e=t.target||t.srcElement;e.parentNode.removeChild(e)},!1):e.attachEvent&&e.attachEvent("onreadystatechange",function(t){var e=window.event.srcElement;!e||"loaded"!=e.readyState&&"complete"!=e.readyState||e.parentNode.removeChild(e)}),setTimeout(function(){document.getElementsByTagName("head")[0].appendChild(e),e=null},1)}var o,s=o=s||{version:"1.5.0"};s.guid="$BAIDU$",function(){window[s.guid]=window[s.guid]||{},s.lang=s.lang||{},s.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},s.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},s.object=s.object||{},s.extend=s.object.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},s.event=s.event||{},s.event._listeners=s.event._listeners||[],s.dom=s.dom||{},s.dom._g=function(t){return s.lang.isString(t)?document.getElementById(t):t},s._g=s.dom._g,s.event.on=function(t,e,i){e=e.replace(/^on/i,""),t=s.dom._g(t);var n,o=function(e){i.call(t,e)},a=s.event._listeners,r=s.event._eventFilter,l=e;return e=e.toLowerCase(),r&&r[e]&&(n=r[e](t,e,o),l=n.type,o=n.listener),t.addEventListener?t.addEventListener(l,o,!1):t.attachEvent&&t.attachEvent("on"+l,o),a[a.length]=[t,e,i,o,l],t},s.on=s.event.on,s.event.un=function(t,e,i){t=s.dom._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var n,o,a,r=s.event._listeners,l=r.length,p=!i;l--;)n=r[l],n[1]!==e||n[0]!==t||!p&&n[2]!==i||(o=n[4],a=n[3],t.removeEventListener?t.removeEventListener(o,a,!1):t.detachEvent&&t.detachEvent("on"+o,a),r.splice(l,1));return t},s.un=s.event.un,s.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},s.g=s.G=s.dom.g,s.string=s.string||{},s.browser=s.browser||{},s.browser.ie=s.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,s.dom._NAME_ATTRS=function(){var t={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};return s.browser.ie<8?(t.for="htmlFor",t.class="className"):(t.htmlFor="for",t.className="class"),t}(),s.dom.setAttr=function(t,e,i){return t=s.dom.g(t),"style"==e?t.style.cssText=i:(e=s.dom._NAME_ATTRS[e]||e,t.setAttribute(e,i)),t},s.setAttr=s.dom.setAttr,s.dom.setAttrs=function(t,e){t=s.dom.g(t);for(var i in e)s.dom.setAttr(t,i,e[i]);return t},s.setAttrs=s.dom.setAttrs,s.dom.create=function(t,e){var i=document.createElement(t),n=e||{};return s.dom.setAttrs(i,n)},s.cookie=s.cookie||{},s.cookie._isValidKey=function(t){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(t)},s.cookie.getRaw=function(t){if(s.cookie._isValidKey(t)){var e=new RegExp("(^| )"+t+"=([^;]*)(;|$)"),i=e.exec(document.cookie);if(i)return i[2]||null}return null},s.cookie.get=function(t){var e=s.cookie.getRaw(t);return"string"==typeof e?e=decodeURIComponent(e):null},s.cookie.setRaw=function(t,e,i){if(s.cookie._isValidKey(t)){i=i||{};var n=i.expires;"number"==typeof i.expires&&(n=new Date,n.setTime(n.getTime()+i.expires)),document.cookie=t+"="+e+(i.path?"; path="+i.path:"")+(n?"; expires="+n.toGMTString():"")+(i.domain?"; domain="+i.domain:"")+(i.secure?"; secure":"")}},s.cookie.set=function(t,e,i){s.cookie.setRaw(t,encodeURIComponent(e),i)},s.cookie.remove=function(t,e){e=e||{},e.expires=new Date(0),s.cookie.setRaw(t,"",e)},s.isPhone=function(t){return/\d{11}/.test(t)},s.isActivateCode=function(t){return/\d{4}/.test(t)},o.undope=!0}();var a=n.SearchInfoWindow=function(t,e,i){this.guid=l++,n.SearchInfoWindow.instance[this.guid]=this,this._isOpen=!1,this._map=t,this._opts=i=i||{},this._content=e||"",this._opts.width=i.width,this._opts.height=i.height,this._opts._title=i.title||"",this._opts.offset=i.offset||new BMap.Size(0,0),this._opts.enableAutoPan=i.enableAutoPan!==!1,this._opts._panel=i.panel||null,this._opts._searchTypes=i.searchTypes,this._opts.enableSendToPhone=i.enableSendToPhone};a.prototype=new BMap.Overlay,a.prototype.initialize=function(t){this._closeOtherSearchInfo();var e=this,i=this._createSearchTemplate(),n=t.getPanes().floatPane;return n.style.width="auto",n.appendChild(i),this._initSearchTemplate(),this._getSearchInfoWindowSize(),this._boxWidth=parseInt(this.container.offsetWidth,10),this._boxHeight=parseInt(this.container.offsetHeight,10),s.event.on(i,"onmousedown",function(t){e._stopBubble(t)}),s.event.on(i,"ontouchstart",function(t){e._stopBubble(t)}),s.event.on(i,"touchmove",function(t){e._stopBubble(t)}),s.event.on(i,"touchend",function(t){e._stopBubble(t)}),s.event.on(i,"onmouseover",function(t){e._stopBubble(t)}),s.event.on(i,"click",function(t){e._stopBubble(t)}),s.event.on(i,"dblclick",function(t){e._stopBubble(t)}),i},a.prototype.draw=function(){this._isOpen&&this._adjustPosition(this._point)},a.prototype.open=function(t){this._map.closeInfoWindow();var e,i=this;this._isOpen||(this._map.addOverlay(this),this._isOpen=!0,setTimeout(function(){i._dispatchEvent(i,"open",{point:i._point})},10)),t instanceof BMap.Point?(e=t,this._removeMarkerEvt(),this._marker=null):t instanceof BMap.Marker&&(this._marker&&this._removeMarkerEvt(),e=t.getPosition(),this._marker=t,!this._markerDragend&&this._marker.addEventListener("dragend",this._markerDragend=function(t){i._point=t.point,i._adjustPosition(i._point),i._panBox(),i.show()}),!this._markerDragging&&this._marker.addEventListener("dragging",this._markerDragging=function(){i.hide(),i._point=i._marker.getPosition(),i._adjustPosition(i._point)})),this.show(),this._point=e,this._panBox(),this._adjustPosition(this._point)},a.prototype.close=function(){this._isOpen&&(this._map.removeOverlay(this),this._disposeAutoComplete(),this._isOpen=!1,this._dispatchEvent(this,"close",{point:this._point}))},a.prototype.enableAutoPan=function(){this._opts.enableAutoPan=!0},a.prototype.disableAutoPan=function(){this._opts.enableAutoPan=!1},a.prototype.setContent=function(t){this._setContent(t),this._getSearchInfoWindowSize(),this._adjustPosition(this._point)},a.prototype.setTitle=function(t){this.dom.title.innerHTML=t,this._opts._title=t},a.prototype.getContent=function(){return this.dom.content.innerHTML},a.prototype.getTitle=function(){return this.dom.title.innerHTML},a.prototype.setPosition=function(t){this._point=t,this._adjustPosition(t),this._panBox(),this._removeMarkerEvt()},a.prototype.getPosition=function(){return this._point},a.prototype.getOffset=function(){return this._opts.offset},s.object.extend(a.prototype,{_closeOtherSearchInfo:function(){for(var t=n.SearchInfoWindow.instance,e=t.length;e--;)t[e]._isOpen&&t[e].close()},_setContent:function(t){if(this.dom&&this.dom.content){void 0===t.nodeType?this.dom.content.innerHTML=t:this.dom.content.appendChild(t);this._adjustContainerWidth(),this._content=t}},_adjustPosition:function(t){var e=this._getPointPosition(t),i=this._marker&&this._marker.getIcon();this._marker?(this.container.style.bottom=-(e.y-this._opts.offset.height-i.anchor.height+i.infoWindowAnchor.height)-this._marker.getOffset().height+2+30+"px",this.container.style.left=e.x-i.anchor.width+this._marker.getOffset().width+i.infoWindowAnchor.width-this._boxWidth/2+28+"px"):(this.container.style.bottom=e.y-this._opts.offset.height-30+"px",this.container.style.left=e.x-this._boxWidth/2+25+"px")},_getPointPosition:function(t){return this._pointPosition=this._map.pointToOverlayPixel(t),this._pointPosition},_getSearchInfoWindowSize:function(){this._boxWidth=parseInt(this.container.offsetWidth,10),this._boxHeight=parseInt(this.container.offsetHeight,10)},_stopBubble:function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},_panBox:function(){if(this._opts.enableAutoPan){var t=parseInt(this._map.getContainer().offsetHeight,10),e=parseInt(this._map.getContainer().offsetWidth,10),i=this._boxHeight,n=this._boxWidth;if(!(i>=t||n>=e)){this._map.getBounds().containsPoint(this._point)||this._map.setCenter(this._point);var o,s,a=this._map.pointToPixel(this._point),r=n/2-28-a.x+10,l=n/2+28+a.x-e+10;if(this._marker)var p=this._marker.getIcon();var h=this._marker?p.anchor.height+this._marker.getOffset().height-p.infoWindowAnchor.height:0;o=i-a.y+this._opts.offset.height+h+31+10,panX=r>0?r:l>0?-l:0,s=o>0?o:0,this._map.panBy(panX,s)}}},_removeMarkerEvt:function(){this._markerDragend&&this._marker.removeEventListener("dragend",this._markerDragend),this._markerDragging&&this._marker.removeEventListener("dragging",this._markerDragging),this._markerDragend=this._markerDragging=null},_dispatchEvent:function(t,e,i){0!=e.indexOf("on")&&(e="on"+e);var n=new s.lang.Event(e);if(i)for(var o in i)n[o]=i[o];t.dispatchEvent(n)},_initSearchTemplate:function(){this._initDom(),this._initPanelTemplate(),this.setTitle(this._opts._title),this._opts.height&&(this.dom.content.style.height=parseInt(this._opts.height,10)+"px"),this._setContent(this._content),this._initService(),this._bind(),this._opts._searchTypes&&this._setSearchTypes(),this._mendIE6()},_createSearchTemplate:function(){if(!this._div){var t=s.dom.create("div",{class:"BMapLib_SearchInfoWindow",id:"BMapLib_SearchInfoWindow"+this.guid}),e=['<div class="BMapLib_bubble_top">','<div class="BMapLib_bubble_title" id="BMapLib_bubble_title'+this.guid+'"></div>','<div class="BMapLib_bubble_tools">','<div class="BMapLib_bubble_close" title="关闭" id="BMapLib_bubble_close'+this.guid+'">',"</div>",'<div class="BMapLib_sendToPhone" title="发送到手机" id="BMapLib_sendToPhone'+this.guid+'">',"</div>","</div>","</div>",'<div class="BMapLib_bubble_center">','<div class="BMapLib_bubble_content" id="BMapLib_bubble_content'+this.guid+'">',"</div>",'<div class="BMapLib_nav" id="BMapLib_nav'+this.guid+'">','<ul class="BMapLib_nav_tab" id="BMapLib_nav_tab'+this.guid+'">','<li class="BMapLib_first BMapLib_current" id="BMapLib_tab_search'+this.guid+'" style="display:block;">','<span class="BMapLib_icon BMapLib_icon_nbs"></span>在附近找',"</li>",'<li class="" id="BMapLib_tab_tohere'+this.guid+'" style="display:block;">','<span class="BMapLib_icon BMapLib_icon_tohere"></span>到这里去',"</li>",'<li class="" id="BMapLib_tab_fromhere'+this.guid+'" style="display:block;">','<span class="BMapLib_icon BMapLib_icon_fromhere"></span>从这里出发',"</li>","</ul>",'<ul class="BMapLib_nav_tab_content">','<li id="BMapLib_searchBox'+this.guid+'">','<table width="100%" align="center" border=0 cellpadding=0 cellspacing=0>','<tr><td style="padding-left:8px;"><input id="BMapLib_search_text'+this.guid+'" class="BMapLib_search_text" type="text" maxlength="100" autocomplete="off"></td><td width="55" style="padding-left:7px;"><input id="BMapLib_search_nb_btn'+this.guid+'" type="submit" value="搜索" class="iw_bt"></td></tr>',"</table>","</li>",'<li id="BMapLib_transBox'+this.guid+'" style="display:none">','<table width="100%" align="center" border=0 cellpadding=0 cellspacing=0>','<tr><td width="30" style="padding-left:8px;"><div id="BMapLib_stationText'+this.guid+'">起点</div></td><td><input id="BMapLib_trans_text'+this.guid+'" class="BMapLib_trans_text" type="text" maxlength="100" autocomplete="off"></td><td width="106" style="padding-left:7px;"><input id="BMapLib_search_bus_btn'+this.guid+'" type="button" value="公交" class="iw_bt" style="margin-right:5px;"><input id="BMapLib_search_drive_btn'+this.guid+'" type="button" class="iw_bt" value="驾车"></td></tr>',"</table>","</li>","</ul>","</div>","</div>",'<div class="BMapLib_bubble_bottom"></div>','<img src="http://api.map.baidu.com/library/SearchInfoWindow/1.4/src/iw_tail.png" width="58" height="31" alt="" class="BMapLib_trans" id="BMapLib_trans'+this.guid+'" style="left:144px;"/>'];t.innerHTML=e.join(""),this._div=t}return this._div},_initPanelTemplate:function(){var t=s.g(this._opts._panel);if(!this.dom.panel&&t){t.innerHTML="",this.dom.panel=t;var e=s.dom.create("div");e.style.cssText="display:none;background:#FD9;height:30px;line-height:30px;text-align:center;font-size:12px;color:#994C00;",t.appendChild(e),this.dom.panel.address=e;var i=s.dom.create("div");t.appendChild(i),this.dom.panel.localSearch=i}},_initDom:function(){this.dom||(this.dom={container:s.g("BMapLib_SearchInfoWindow"+this.guid),content:s.g("BMapLib_bubble_content"+this.guid),title:s.g("BMapLib_bubble_title"+this.guid),closeBtn:s.g("BMapLib_bubble_close"+this.guid),transIco:s.g("BMapLib_trans"+this.guid),navBox:s.g("BMapLib_nav"+this.guid),navTab:s.g("BMapLib_nav_tab"+this.guid),seartTab:s.g("BMapLib_tab_search"+this.guid),tohereTab:s.g("BMapLib_tab_tohere"+this.guid),fromhereTab:s.g("BMapLib_tab_fromhere"+this.guid),searchBox:s.g("BMapLib_searchBox"+this.guid),transBox:s.g("BMapLib_transBox"+this.guid),stationText:s.g("BMapLib_stationText"+this.guid),nbBtn:s.g("BMapLib_search_nb_btn"+this.guid),busBtn:s.g("BMapLib_search_bus_btn"+this.guid),driveBtn:s.g("BMapLib_search_drive_btn"+this.guid),searchText:s.g("BMapLib_search_text"+this.guid),transText:s.g("BMapLib_trans_text"+this.guid),sendToPhoneBtn:s.g("BMapLib_sendToPhone"+this.guid)},this.container=this.dom.container)},_adjustContainerWidth:function(){var t=250;this._opts.width?(t=parseInt(this._opts.width,10),t+=10):t=parseInt(this.dom.content.offsetWidth,10),t<250&&(t=250),this._width=t,this.container.style.width=this._width+"px",this._adjustTransPosition()},_adjustTransPosition:function(){this.dom.transIco.style.left=this.container.offsetWidth/2-2-29+"px",this.dom.transIco.style.top=this.container.offsetHeight-2+"px"},_initService:function(){var t=this._map,e=this,i={};i.map=t,this.dom.panel&&(i.panel=this.dom.panel.localSearch),this.localSearch||(this.localSearch=new BMap.LocalSearch(t,{renderOptions:i,onSearchComplete:function(t){e._clearAddress(),e._drawCircleBound()}})),this.transitRoute||(this.transitRoute=new BMap.TransitRoute(t,{renderOptions:i,onSearchComplete:function(t){e._transitRouteComplete(e.transitRoute,t)}})),this.drivingRoute||(this.drivingRoute=new BMap.DrivingRoute(t,{renderOptions:i,onSearchComplete:function(t){e._transitRouteComplete(e.drivingRoute,t)}}))},_bind:function(){var t=this;s.on(this.dom.closeBtn,"click",function(e){t.close()}),s.on(this.dom.closeBtn,"touchstart",function(e){t.close()}),s.on(this.dom.sendToPhoneBtn,"click",function(e){t._sendToPhone()}),s.on(this.dom.sendToPhoneBtn,"touchstart",function(e){t._sendToPhone()}),s.on(this.dom.seartTab,"click",function(e){t._showTabContent(0)}),s.on(this.dom.seartTab,"touchstart",function(e){t._showTabContent(0)}),s.on(this.dom.tohereTab,"click",function(e){t._showTabContent(1)}),s.on(this.dom.tohereTab,"touchstart",function(e){t._showTabContent(1)}),s.on(this.dom.fromhereTab,"click",function(e){t._showTabContent(2)}),s.on(this.dom.fromhereTab,"touchstart",function(e){t._showTabContent(2)}),s.on(this.dom.searchText,"click",function(e){t._localSearchAction()}),s.on(this.dom.searchText,"touchstart",function(e){t._localSearchAction()}),s.on(this.dom.nbBtn,"click",function(e){t._localSearchAction()}),s.on(this.dom.nbBtn,"touchstart",function(e){t._localSearchAction()}),s.on(this.dom.busBtn,"click",function(e){t._transitRouteAction(t.transitRoute)}),s.on(this.dom.busBtn,"touchstart",function(e){t._transitRouteAction(t.transitRoute)}),s.on(this.dom.driveBtn,"click",function(e){t._transitRouteAction(t.drivingRoute)}),s.on(this.dom.driveBtn,"touchstart",function(e){t._transitRouteAction(t.drivingRoute)}),this._autoCompleteIni(),this._opts.enableSendToPhone===!1&&(this.dom.sendToPhoneBtn.style.display="none")},_showTabContent:function(t){this._hideAutoComplete();for(var e=this.dom.navTab.getElementsByTagName("li"),i=e.length,n=0,i=e.length;n<i;n++)e[n].className="";switch(t){case 0:this.dom.seartTab.className="BMapLib_current",this.dom.searchBox.style.display="block",this.dom.transBox.style.display="none";break;case 1:this.dom.tohereTab.className="BMapLib_current",this.dom.searchBox.style.display="none",this.dom.transBox.style.display="block",this.dom.stationText.innerHTML="起点",this._pointType="endPoint";break;case 2:this.dom.fromhereTab.className="BMapLib_current",this.dom.searchBox.style.display="none",this.dom.transBox.style.display="block",this.dom.stationText.innerHTML="终点",this._pointType="startPoint"}this._firstTab.className+=" BMapLib_first"},_autoCompleteIni:function(){this.searchAC=new BMap.Autocomplete({input:this.dom.searchText,location:this._map}),this.transAC=new BMap.Autocomplete({input:this.dom.transText,location:this._map})},_hideAutoComplete:function(){this.searchAC.hide(),this.transAC.hide()},_disposeAutoComplete:function(){this.searchAC.dispose(),this.transAC.dispose()},_localSearchAction:function(){var t=this._kw=this.dom.searchText.value;if(""==t)this.dom.searchText.focus();else{this._reset(),this.close();var e=this._radius=1e3;this.localSearch.searchNearby(t,this._point,e)}},_drawCircleBound:function(){this._closeCircleBound();var e=this._searchCircle=new BMap.Circle(this._point,this._radius,{strokeWeight:3,strokeOpacity:.4,strokeColor:"#e00",filColor:"#00e",fillOpacity:.4}),i=this._searchLabel=new t(this._point,this.guid);this._map.addOverlay(e),this._map.addOverlay(i),this._hasCircle=!0},_changeSearchRadius:function(){var t=parseInt(s.g("BMapLib_search_radius"+this.guid).value,10);t>0&&t!=this._radius&&(this._radius=t,this.localSearch.searchNearby(this._kw,this._point,t),this._closeCircleBound())},_closeCircleBound:function(t){this._searchCircle&&this._map.removeOverlay(this._searchCircle),this._searchLabel&&this._map.removeOverlay(this._searchLabel),this._hasCircle=!1},_transitRouteAction:function(t){var e=this.dom.transText.value;if(""==e)this.dom.transText.focus();else{this._reset(),this.close();var i=this._getTransPoi(e);t.search(i.start,i.end)}},_transitRouteComplete:function(t,e){if(this._clearAddress(),t.getStatus()==BMAP_STATUS_UNKNOWN_ROUTE){var i=e.getStartStatus(),n=e.getEndStatus(),o="";o="找不到相关的线路",i==BMAP_ROUTE_STATUS_EMPTY&&n==BMAP_ROUTE_STATUS_EMPTY?o="找不到相关的起点和终点":(i==BMAP_ROUTE_STATUS_EMPTY&&(o="找不到相关的起点"),n==BMAP_ROUTE_STATUS_EMPTY&&(o="找不到相关的终点")),"startPoint"==this._pointType&&n==BMAP_ROUTE_STATUS_ADDRESS||"endPoint"==this._pointType&&i==BMAP_ROUTE_STATUS_ADDRESS?this._searchAddress(t):(this.dom.panel.address.style.display="block",this.dom.panel.address.innerHTML=o)}},_searchAddress:function(t){var e=this,i=this.dom.panel;if(!this.lsAddress){var n={map:this._map};i&&(n.panel=this.dom.panel.localSearch),this.lsAddress=new BMap.LocalSearch(this._map,{renderOptions:n})}var o="startPoint"==e._pointType?"终点":"起点";i&&(this.dom.panel.address.style.display="block",this.dom.panel.address.innerHTML="请选择准确的"+o),this.lsAddress.setInfoHtmlSetCallback(function(i,n){var a=document.createElement("div");a.style.cssText="position:relative;left:50%;margin:5px 0 0 -30px;width:60px;height:27px;line-height:27px;border:1px solid #E0C3A6;text-align:center;color:#B35900;cursor:pointer;background-color:#FFEECC;border-radius:2px; background-image: -webkit-gradient(linear, left top, left bottom, from(#FFFDF8), to(#FFEECC))",a.innerHTML="设为"+o,n.appendChild(a),s.on(a,"click",function(){e._clearAddress();var n=i.marker.getPosition();"起点"==o?t.search(n,e._point):t.search(e._point,n)})}),this._reset(),this.lsAddress.search(this.dom.transText.value)},_getTransPoi:function(t){var e,i;return"startPoint"==this._pointType?(e=this._point,i=t):(e=t,i=this._point),{start:e,end:i}},_setSearchTypes:function(){var t,e=this._unique(this._opts._searchTypes),i=this.dom.navTab,n=[this.dom.seartTab,this.dom.tohereTab,this.dom.fromhereTab],o=0,a=0,r=0;if(this.tabLength=e.length,tabWidth=Math.floor((this._width-this.tabLength+1)/this.tabLength),0==e.length)this.dom.navBox.style.display="none";else{for(o=0,a=n.length;o<a;o++)n[o].className="",n[o].style.display="none";for(o=0;o<this.tabLength;o++){if(t=n[e[o]],0==o&&(t.className="BMapLib_first BMapLib_current",this._firstTab=t,r=e[o]),o==this.tabLength-1){var l=this._width-(this.tabLength-1)*(tabWidth+1);6==s.browser.ie?t.style.width=l-3+"px":t.style.width=l+"px"}else t.style.width=tabWidth+"px";t.style.display="block"}void 0!=e[1]&&i.appendChild(n[e[1]]),void 0!=e[2]&&i.appendChild(n[e[2]]),this._showTabContent(r)}this._adjustTransPosition()},_unique:function(t){for(var e,i,n=t.length,o=t.slice(0);--n>=0;)if((i=o[n])<0||i>2)o.splice(n,1);else for(e=n;e--;)if(i==o[e]){o.splice(n,1);break}return o},_reset:function(){this.localSearch.clearResults(),this.transitRoute.clearResults(),this.drivingRoute.clearResults(),this._closeCircleBound(),this._hideAutoComplete()},_clearAddress:function(){this.lsAddress&&this.lsAddress.clearResults(),this.dom.panel&&(this.dom.panel.address.style.display="none")},_mendIE6:function(t){if(s.browser.ie&&!(s.browser.ie>6))for(var e=this.container.getElementsByTagName("IMG"),i=0;i<e.length;i++)e[i].src.indexOf(".png")<0||(e[i].style.cssText+=";FILTER: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+e[i].src+",sizingMethod=crop)",e[i].src="http://api.map.baidu.com/images/blank.gif")},_sendToPhone:function(){this.showPopup()},showPopup:function(){this.pop||(this.pop=new e(this)),this._map.addOverlay(this.pop)}}),t.prototype=new BMap.Overlay,t.prototype.initialize=function(t){function e(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0}this._map=t;var i=this._div=document.createElement("div");s.on(i,"mousedown",e),s.on(i,"touchstart",e),s.on(i,"click",e),s.on(i,"dblclick",e);var o=n.SearchInfoWindow.instance[this.guid];return i.style.cssText="position:absolute;white-space:nowrap;background:#fff;padding:1px;border:1px solid red;z-index:99;",i.innerHTML='<input type="text" value="'+o._radius+'" style="width:30px;" id="BMapLib_search_radius'+this.guid+'"/>m <a href="javascript:void(0)" title="修改" onclick="BMapLib.SearchInfoWindow.instance['+this.guid+']._changeSearchRadius()" style="font-size:12px;text-decoration:none;color:blue;">修改</a><img src="http://api.map.baidu.com/images/iw_close1d3.gif" alt="关闭" title="关闭" style="cursor:pointer;padding:0 5px;" onclick="BMapLib.SearchInfoWindow.instance['+this.guid+']._closeCircleBound()"/>',t.getPanes().labelPane.appendChild(i),i},t.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this._point);this._div.style.left=e.x+10+"px",this._div.style.top=e.y-25+"px"};var r="http://api.map.baidu.com";e.prototype=new BMap.Overlay,s.extend(e.prototype,{initialize:function(t){return this._map=t,this.container=this.generalDom(),this._map.getContainer().appendChild(this.container),this.initDom(),this.bind(),this.getAddressByPoint(),this.getRememberPhone(),this.addPhoneNum=0,this.container},draw:function(){},generalDom:function(){var t=document.createElement("div"),e=this._map.getSize(),i=0,n=0;e.width>450&&(n=(e.width-450)/2),e.height>260&&(i=(e.height-260)/2),t.style.cssText="position:absolute;background:#fff;width:480px;height:260px;top:"+i+"px;left:"+n+"px;ovflow:hidden;";var o=['<div class="BMapLib_sms_tab_container">',"<span>发送到手机</span>",'<span id="BMapLib_sms_tip" style="display:none;">',"</span>","</div>",'<div id="BMapLib_sms_pnl_phone" class="BMapLib_sms_pnl_phone" style="display: block;">','<div class="BMapLib_ap" id="pnl_phone_left" style="display: block;">',"<table>","<tr>","<th>发送方手机号</th>",'<td><input type="text" bid="" id="BMapLib_phone_0" maxlength="11" class="BMapLib_sms_input BMapLib_sms_input_l" /><span id="BMapLib_activateTip"></span></td>',"</tr>",'<tr id="BMapLib_activateBox" style="display:none;">',"<th>激活码</th>",'<td><input type="text" id="BMapLib_activate" class="BMapLib_sms_input BMapLib_sms_input_s" maxlength="4"/><input type="button" value="获取" id="BMapLib_activate_btn" bid="activate" />',"</tr>","<tr>","<th></th>","<td>","</td>","</tr>","<tr>",'<th style="vertical-align:top;padding-top:7px;">接收方手机号</th>','<td><div><input type="text" id="BMapLib_phone_1" class="BMapLib_sms_input BMapLib_sms_input_l" maxlength="11"/><input type="checkbox" id="BMapLib_is_remember_phone"/>记住此号</div>','<div id="BMapLib_add_phone_con"></div>','<div><a href="javascript:void(0)" id="BMapLib_add_phone_btn" bid="addPhone">新增</a></div>',"</td>","</tr>","<tr>","<th></th>",'<td ><input type="text" id="BMapLib_ver_input"  maxlength="4" style="width:67px;border: 1px solid #a5acb2;vertical-align: middle;height:18px;" tabindex="5" placeholder="验证码"><img width="69" height="20" id="BMapLib_ver_image" bid="BMapLib_ver_image" style="border: 1px solid #d5d5d5;vertical-align:middle;margin-left: 5px;" alt="点击更换数字" title="点击更换数字"></td>',"</tr>","<tr>","<th></th>",'<td><input type="button" value="免费发送到手机" bid="sendToPhoneBtn"/></td>',"</tr>","</table>","</div>",'<div class="BMapLib_mp" id="pnl_phone_right" style="display: block;">','<div class="BMapLib_mp_title">短信内容：</div>','<div id="BMapLib_msgContent" class="BMapLib_msgContent"></div>',"</div>",'<div style="clear:both;"></div>','<p id="BMapLib_sms_declare_phone" class="BMapLib_sms_declare_phone">百度保证不向任何第三方提供输入的手机号码</p>','<div id="tipError" class="tip fail" style="display:none;">','<span id="tipText"></span>','<a href="javascript:void(0)" id="tipClose" class="cut"></a>',"</div>",'<div id="sms_lack_tip" style="display:none;">已达每日5次短信上限</div>','<div id="sms_unlogin_tip" style="display:none;">','<div style="padding-left:40px;">','<ul class="login_ul"><li id="normal_login-2" class="login_hover"><a href="javascript:void(0)">手机登录</a></li></ul>','<div id="loginBox_02" class="loginBox">','<div id="pass_error_info-2" class="pass_error_style"></div>','<div id="passports-2"></div>','<div id="loginIframe_iph-2" style="display:none"></div>',"</div>","</div>",'<div class="nopass" style="padding-left:128px;">没有百度帐号？<a href="https://passport.baidu.com/v2/?reg&amp;regType=1&amp;tpl=ma" target="_blank">立即注册</a></div>',"</div>","</div>",'<button class="BMapLib_popup_close" bid="close"></button>','<div id="BMapLib_success_tip" style="display:none;">您的短信已经发送到您的手机，请注意查收!</div>'].join("");return t.innerHTML=o,t},initDom:function(){this.dom={sms_tip:s.g("BMapLib_sms_tip"),activate_btn:s.g("BMapLib_activate_btn"),fromphone:s.g("BMapLib_phone_0"),tophone:s.g("BMapLib_phone_1"),isRememberPhone:s.g("BMapLib_is_remember_phone"),sms_container:s.g("BMapLib_sms_pnl_phone"),success_tip:s.g("BMapLib_success_tip"),add_phone_con:s.g("BMapLib_add_phone_con"),add_phone_btn:s.g("BMapLib_add_phone_btn"),activateBox:s.g("BMapLib_activateBox"),activateTip:s.g("BMapLib_activateTip"),activate_input:s.g("BMapLib_activate"),ver_image:s.g("BMapLib_ver_image"),ver_input:s.g("BMapLib_ver_input")}},showTip:function(t){var e=t.error,i={PHONE_NUM_INVALID:"手机号码无效",SMS_SEND_SUCCESS:"发送到手机成功",AK_INVALID:"你所使用的key无效",INTERNAL_ERROR:"服务器错误",OVER_MAX_ACTIVATE_TIME:"今天已超过发送激活码最大次数",SMS_ACTIVATE_SUCCESS:"激活码已发送到您的手机，请注意查收！",ACTIVATE_FAIL:"手机激活码无效",SMS_LACK:"今天您还能往5个手机发送短信",PARAM_INVALID:"请填完所有选项",SEND_ACTIVATE_FAIL:"激活码发送失败",VCODE_VERITY_FAIL:"验证码校验失败"},n=i[e];if("SMS_LACK"==e){var o=t.res_sms;n="今天您还能往"+o+"个手机发送短信",this.addPhoneNum=o-1}this.renderImageVer(),n&&(this.dom.sms_tip.innerHTML=n,this.dom.sms_tip.style.display="inline"),"SMS_SEND_SUCCESS"==e&&(this.rememberPhone(),this.sendSuccess())},bind:function(){var t=this;t.renderImageVer(),s.on(this.container,"click",function(e){var i=e.target||e.srcElement;switch(i.getAttribute("bid")){case"close":t.closeActon();break;case"sendToPhoneBtn":t.sendAction();break;case"activate":t.activateAction();break;case"addPhone":t.addPhoneAction();break;case"deletePhone":t.deletePhoneAction(i);break;case"BMapLib_ver_image":t.renderImageVer()}});s.g("BMapLib_phone_0"),s.g("BMapLib_phone_1");this.container.onkeypress=function(t){var e=t||window.e,i=e.which||e.keyCode,n=!1;return(i>=48&&i<=57||44==i||8==i)&&(n=!0),n},this.dom.ver_input.onkeypress=function(e){t._stopBubble(e);var i=e||window.e,n=i.which||i.keyCode,o=!1;return(n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122)&&(o=!0),o},s.on(this.dom.fromphone,"blur",function(){s.isPhone(this.value)?t.checkActivateAction():(t.dom.activateTip.innerHTML="",t.dom.activateBox.style.display="none")}),s.on(this.dom.activate_input,"blur",function(){s.isActivateCode(this.value)&&t.checkActivateAction()})},_stopBubble:function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},renderImageVer:function(){var t=this;this.request("http://map.baidu.com/maps/services/captcha?",{cbName:"cb"},function(e){t.vcode=e.content.vcode,t.dom.ver_image.src="http://map.baidu.com/maps/services/captcha/image?vcode="+t.vcode})},checkActivateAction:function(){var t={phone:this.dom.fromphone.value,activate:this.dom.activate_input.value,cbName:"callback"},e=this;this.request(this.config.ckActivateURL,t,function(t){t&&0!=t.isactivate?(e.dom.activateBox.style.display="none",e.dom.activateTip.style.color="green",e.dom.activateTip.innerHTML="已激活"):(e.dom.activateBox.style.display="table-row",e.dom.activateTip.style.color="red",e.dom.activateTip.innerHTML="未激活")})},activateAction:function(){var t=this,e=this._map.getKey(),i={phone:this.dom.fromphone.value,ak:e,cbName:"callback"};s.isPhone(i.phone)?this.request(this.config.activateURL,i,function(e){e&&t.showTip(e)}):this.showTip({error:"PHONE_NUM_INVALID"})},closeActon:function(){this._map.removeOverlay(this)},getMessage:function(){},sendAction:function(){var t=this;if(this.validate()){tophoneStr=s.g("BMapLib_phone_1").value;for(var e=this.dom.add_phone_con.getElementsByTagName("input"),i=0,n=e.length;i<n;i++){if(!s.isPhone(e[i].value))return void this.showTip({error:"PHONE_NUM_INVALID"});tophoneStr+=","+e[i].value}var o=this._map.getKey(),a={fromphone:s.g("BMapLib_phone_0").value,tophone:tophoneStr,ak:o,activate:this.dom.activate_input.value,code_input:this.dom.ver_input.value,vcode:this.vcode,content:s.g("BMapLib_phone_0").value+"分享一个位置给您，"+this.messageContent,cbName:"callback"};this.request(this.config.sendURL,a,function(e){e&&t.showTip(e)})}},validate:function(){var t=!0;return s.isPhone(this.dom.fromphone.value)&&s.isPhone(this.dom.tophone.value)||(t=!1,this.showTip({error:"PHONE_NUM_INVALID"})),t},getAddressByPoint:function(){var t=this.iw._point,e=this;(new BMap.Geocoder).getLocation(t,function(t){if(t&&t.addressComponents){var i=t.addressComponents;e.address=i.province+i.city+i.district+i.street+i.streetNumber,e.generalMessage()}})},generalMessage:function(){var t=s.g("BMapLib_msgContent"),e="",i=this.iw,n=i.getPosition();this.userPhone&&(e+=this.userPhone+"分享一个位置给您，"),i.getTitle&&(e+="名称为："+i.getTitle()+"，"),this.address&&(e+="大致位置在"+this.address+"，");var o="http://api.map.baidu.com/marker?location="+n.lat+","+n.lng+"&title="+encodeURIComponent(i.getTitle())+"&content="+encodeURIComponent(i.getContent())+"&output=html",a={url:encodeURIComponent(o),t:(new Date).getTime(),cbName:"callback"},r=this;this.request(this.config.shortURL,a,function(i){e+=i.url,r.messageContent=e,t.innerHTML=e})},rememberPhone:function(){if(this.dom.isRememberPhone.checked){var t=this.dom.tophone.value;s.cookie.set("BMapLib_phone",t,{path:"/",expires:2592e6})}},getRememberPhone:function(){var t=s.cookie.get("BMapLib_phone");t&&(this.dom.tophone.value=t,this.dom.isRememberPhone.checked=!0)},sendSuccess:function(){this.dom.sms_container.style.display="none",this.dom.success_tip.style.display="block";var t=this;setTimeout(function(){t._map.removeOverlay(t)},1500)},addPhoneAction:function(){if(this.addPhoneNum>=4);else{var t=document.createElement("div");t.innerHTML='<input type="text" class="BMapLib_sms_input BMapLib_sms_input_l" maxlength="11"/><a href="javascript:void(0);" style="margin-left:5px;" bid="deletePhone">删除</a>',this.dom.add_phone_con.appendChild(t),this.addPhoneNum++}},deletePhoneAction:function(t){t.parentNode.parentNode.removeChild(t.parentNode),this.addPhoneNum--},request:function(t,e,o){var s=(1e5*Math.random()).toFixed(0);n["BMapLib_cbk"+s]=function(t){o&&o(t),delete n["BMapLib_cbk"+s]};for(var a in e)"cbName"!=a&&(t+="&"+a+"="+e[a]);t+="&"+e.cbName+"=BMapLib.BMapLib_cbk"+s,i(t)},config:{sendURL:r+"/ws/message?method=send",activateURL:r+"/ws/message?method=activate",ckActivateURL:r+"/ws/message?method=ckActivate",shortURL:"http://j.map.baidu.com/?"}});var l=0;n.SearchInfoWindow.instance=[]}()},function(t,e){var i=window.BMapLib=i||{};!function(){function t(t,e,i){var n,o;return t.insertAdjacentHTML?t.insertAdjacentHTML(e,i):(n=t.ownerDocument.createRange(),e=e.toUpperCase(),"AFTERBEGIN"==e||"BEFOREEND"==e?(n.selectNodeContents(t),n.collapse("AFTERBEGIN"==e)):(o="BEFOREBEGIN"==e,n[o?"setStartBefore":"setEndAfter"](t),n.collapse(o)),n.insertNode(n.createContextualFragment(i))),t}function e(e,i){return t(e,"beforeEnd",i),e.lastChild}function n(t){var t=window.event||t;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function o(t){var t=window.event||t;return t.preventDefault?t.preventDefault():t.returnValue=!1,!1}function s(t,e,i){t&&(e=e.replace(/^on/i,"").toLowerCase(),t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,i))}function a(t,e,i){t&&(e=e.replace(/^on/i,"").toLowerCase(),t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent&&t.detachEvent("on"+e,i))}function r(t){var e={duration:1e3,fps:30,delay:0,transition:h.linear,onStop:function(){}};if(t)for(var i in t)e[i]=t[i];if(this._opts=e,e.delay){var n=this;setTimeout(function(){n._beginTime=(new Date).getTime(),n._endTime=n._beginTime+n._opts.duration,n._launch()},e.delay)}else this._beginTime=(new Date).getTime(),this._endTime=this._beginTime+this._opts.duration,this._launch()}var l=i.SearchInRectangle=function(t,e,i){t&&(this._map=t,this._searchWords=e,this._opts={map:t,followText:"",strokeWeight:2,strokeColor:"#111",style:"solid",fillColor:"#ccc",opacity:.4,cursor:"crosshair",autoClose:!0,autoViewport:!1,alwaysShowOverlay:!0,panel:"",selectFirstResult:"false",_zoomType:0},this._setOptions(i),this._opts.strokeWeight=this._opts.strokeWeight<=0?1:this._opts.strokeWeight,this._opts.opacity=this._opts.opacity<0?0:this._opts.opacity>1?1:this._opts.opacity,this._isOpen=!1,this._fDiv=null,this._followTitle=null,this._overlay=null,this.local=this.localSearch(this))};l.prototype._setOptions=function(t){if(t){if(t.renderOptions)for(var e in t.renderOptions)void 0!==t.renderOptions[e]&&(this._opts[e]=t.renderOptions[e]);t.onSearchComplete&&(this._opts.onSearchComplete=t.onSearchComplete)}},l.prototype.setStrokeColor=function(t){"string"==typeof t&&(this._opts.strokeColor=t,this._updateStyle())},l.prototype.setLineStroke=function(t){"number"==typeof t&&Math.round(t)>0&&(this._opts.strokeWeight=Math.round(t),this._updateStyle())},l.prototype.setLineStyle=function(t){"solid"!=t&&"dashed"!=t||(this._opts.style=t,this._updateStyle())},l.prototype.setOpacity=function(t){"number"==typeof t&&t>=0&&t<=1&&(this._opts.opacity=t,this._updateStyle())},l.prototype.setFillColor=function(t){this._opts.fillColor=t,this._updateStyle()},l.prototype.setCursor=function(t){this._opts.cursor=t,p.setCursor(this._opts.cursor)},l.prototype._updateStyle=function(){if(this._fDiv){this._fDiv.style.border=[this._opts.strokeWeight,"px ",this._opts.style," ",this._opts.color].join("");var t=this._fDiv.style,e=this._opts.opacity;t.opacity=e,t.MozOpacity=e,t.KhtmlOpacity=e,t.filter="alpha(opacity="+100*e+")"}},l.prototype.getCursor=function(){return this._opts.cursor},l.prototype._bind=function(){this.setCursor(this._opts.cursor);var t=this;if(s(this._map.getContainer(),"mousemove",function(e){if(t._isOpen&&t._followTitle){e=window.event||e;if((e.target||e.srcElement)!=p.getDom(t._map))return void t._followTitle.hide();t._mapMoving||t._followTitle.show();var i=p.getDrawPoint(e,!0);t._followTitle.setPosition(i)}}),this._opts.followText){this._followTitle=new BMap.Label(this._opts.followText,{offset:new BMap.Size(14,16),enableMassClear:!1});this._followTitle.setStyles({color:"#333",borderColor:"#ff0103"})}},l.prototype.open=function(){if(1==this._isOpen)return!0;if(!i._toolInUse){i._toolInUse=!0,this._isOpen=!0,this.binded||(this._bind(),this.binded=!0),this._followTitle&&(this._map.addOverlay(this._followTitle),this._followTitle.hide());var e=this,l=this._map,h=0;/msie (\d+\.\d)/i.test(navigator.userAgent)&&(h=document.documentMode||+RegExp.$1);var c=0,d=function(i){if(i=window.event||i,!(0!=i.button&&!h||h&&1!=i.button)&&(h&&p.getDom(l).setCapture&&p.getDom(l).setCapture(),e._isOpen))return c=0,e._bind.isZooming=!0,s(document,"mousemove",_),s(document,"mouseup",u),e._bind.mx=i.layerX||i.offsetX||0,e._bind.my=i.layerY||i.offsetY||0,e._bind.ix=i.pageX||i.clientX||0,e._bind.iy=i.pageY||i.clientY||0,t(p.getDom(l),"beforeBegin",e._generateHTML()),e._fDiv=p.getDom(l).previousSibling,e._fDiv.style.width="0",e._fDiv.style.height="0",e._fDiv.style.left=e._bind.mx+"px",e._fDiv.style.top=e._bind.my+"px",n(i),o(i)},_=function(t){if(1==e._isOpen&&1==e._bind.isZooming){e._overlay&&e._map.removeOverlay(e._overlay);var t=window.event||t,i=t.pageX||t.clientX||0,s=t.pageY||t.clientY||0,a=e._bind.dx=i-e._bind.ix,r=e._bind.dy=s-e._bind.iy,p=Math.abs(a)-e._opts.strokeWeight,h=Math.abs(r)-e._opts.strokeWeight;e._fDiv.style.width=(p<0?0:p)+"px",e._fDiv.style.height=(h<0?0:h)+"px",c=p;var d=[l.getSize().width,l.getSize().height];return a>=0?(e._fDiv.style.right="auto",e._fDiv.style.left=e._bind.mx+"px",e._bind.mx+a>=d[0]-2*e._opts.strokeWeight&&(e._fDiv.style.width=d[0]-e._bind.mx-2*e._opts.strokeWeight+"px",e._followTitle&&e._followTitle.hide())):(e._fDiv.style.left="auto",e._fDiv.style.right=d[0]-e._bind.mx+"px",e._bind.mx+a<=2*e._opts.strokeWeight&&(e._fDiv.style.width=e._bind.mx-2*e._opts.strokeWeight+"px",e._followTitle&&e._followTitle.hide())),r>=0?(e._fDiv.style.bottom="auto",e._fDiv.style.top=e._bind.my+"px",e._bind.my+r>=d[1]-2*e._opts.strokeWeight&&(e._fDiv.style.height=d[1]-e._bind.my-2*e._opts.strokeWeight+"px",e._followTitle&&e._followTitle.hide())):(e._fDiv.style.top="auto",e._fDiv.style.bottom=d[1]-e._bind.my+"px",e._bind.my+r<=2*e._opts.strokeWeight&&(e._fDiv.style.height=e._bind.my-2*e._opts.strokeWeight+"px",e._followTitle&&e._followTitle.hide())),n(t),o(t)}},u=function(t){if(c||e._fDiv.parentNode.removeChild(e._fDiv),1==e._isOpen){if(a(document,"mousemove",_),a(document,"mouseup",u),!c)return;h&&p.getDom(l).releaseCapture&&p.getDom(l).releaseCapture();var i=parseInt(e._fDiv.style.left)+parseInt(e._fDiv.style.width)/2,s=parseInt(e._fDiv.style.top)+parseInt(e._fDiv.style.height)/2,d=[l.getSize().width,l.getSize().height];isNaN(i)&&(i=d[0]-parseInt(e._fDiv.style.right)-parseInt(e._fDiv.style.width)/2),isNaN(s)&&(s=d[1]-parseInt(e._fDiv.style.bottom)-parseInt(e._fDiv.style.height)/2);var g=Math.min(d[0]/Math.abs(e._bind.dx),d[1]/Math.abs(e._bind.dy));g=Math.floor(g);var f=new BMap.Pixel(i-parseInt(e._fDiv.style.width)/2,s+parseInt(e._fDiv.style.height)/2),m=new BMap.Pixel(i+parseInt(e._fDiv.style.width)/2,s-parseInt(e._fDiv.style.height)/2),v=l.pixelToPoint(f),b=l.pixelToPoint(m),y=new BMap.Bounds(v,b);delete e._bind.dx,delete e._bind.dy,delete e._bind.ix,delete e._bind.iy,isNaN(g)?targetZoomLv=l.getZoom()+(0==e._opts._zoomType?1:-1):0==e._opts._zoomType&&(targetZoomLv=Math.round(l.getZoom()+Math.log(g)/Math.log(2)),targetZoomLv<l.getZoom()&&(targetZoomLv=l.getZoom()));var w=l.pixelToPoint({x:i,y:s},l.getZoom());e._opts.autoViewport&&l.centerAndZoom(w,targetZoomLv);var M=p.getDrawPoint(t);e._followTitle&&(e._followTitle.setPosition(M),e._followTitle.show()),e._bind.isZooming=!1,e._fDiv.parentNode.removeChild(e._fDiv),e._fDiv=null}var B=y.getSouthWest(),x=y.getNorthEast(),T=new BMap.Point(x.lng,B.lat),L=new BMap.Point(B.lng,x.lat),C=new BMap.Polygon([B,L,x,T]);return C.setStrokeWeight(e._opts.strokeWeight),C.setStrokeOpacity(e._opts.opacity),C.setFillOpacity(e._opts.opacity),C.setStrokeColor(e._opts.strokeColor),C.setStrokeStyle(e._opts.style),C.setFillColor(e._opts.fillColor),e._overlay=C,l.addOverlay(C),e.local.searchInBounds(e._searchWords,y),e._opts.alwaysShowOverlay||new r({duration:240,fps:20,delay:500,render:function(t){var e=.3*(1-t);C.setStrokeOpacity(e)},finish:function(){l.removeOverlay(e._overlay),C.dispose(),e._overlay=null}}),e._opts.autoClose&&setTimeout(function(){1==e._isOpen&&e.close()},70),n(t),o(t)};return p.show(this._map),this.setCursor(this._opts.cursor),this._isBeginDrawBinded||(s(p.getDom(this._map),"mousedown",d),this._isBeginDrawBinded=!0),!0}},l.prototype.close=function(){this._isOpen&&(this._isOpen=!1,i._toolInUse=!1,this._followTitle&&this._followTitle.hide(),p.hide())},l.prototype.setKeyword=function(t){this._searchWords=t},l.prototype._generateHTML=function(){return["<div style='position:absolute;z-index:300;border:",this._opts.strokeWeight,"px ",this._opts.style," ",this._opts.strokeColor,"; opacity:",this._opts.opacity,"; background: ",this._opts.fillColor,"; filter:alpha(opacity=",Math.round(100*this._opts.opacity),"); width:0; height:0; font-size:0'></div>"].join("")},l.prototype.localSearch=function(t){return new BMap.LocalSearch(t._map,{renderOptions:{map:t._opts.map,autoViewport:!1,panel:t._opts.panel,selectFirstResult:t._opts.selectFirstResult},onSearchComplete:function(e){t._opts.onSearchComplete&&t._opts.onSearchComplete(e)}})};var p={_map:null,_html:"<div style='background:transparent url(http://api.map.baidu.com/images/blank.gif);position:absolute;left:0;top:0;width:100%;height:100%;z-index:1000' unselectable='on'></div>",_maskElement:null,_cursor:"default",_inUse:!1,show:function(t){this._map||(this._map=t),this._inUse=!0,this._maskElement||this._createMask(t),this._maskElement.style.display="block"},_createMask:function(t){if(this._map=t,this._map){var i=this._maskElement=e(this._map.getContainer(),this._html),a=function(t){return n(t),o(t)};s(i,"mouseup",function(t){2==t.button&&a(t)}),s(i,"contextmenu",a),i.style.display="none"}},getDrawPoint:function(t,e){t=window.event||t;var i=t.layerX||t.offsetX||0,n=t.layerY||t.offsetY||0,o=t.target||t.srcElement;if(o!=p.getDom(this._map)&&1==e)for(;o&&o!=this._map.getContainer();)0==o.clientWidth&&0==o.clientHeight&&o.offsetParent&&"td"==o.offsetParent.nodeName.toLowerCase()||(i+=o.offsetLeft,n+=o.offsetTop),o=o.offsetParent;if(!(o!=p.getDom(this._map)&&o!=this._map.getContainer()||void 0===i||void 0===n||isNaN(i)||isNaN(n)))return this._map.pixelToPoint(new BMap.Pixel(i,n))},hide:function(){this._map&&(this._inUse=!1,this._maskElement&&(this._maskElement.style.display="none"))},getDom:function(t){return this._maskElement||this._createMask(t),this._maskElement},setCursor:function(t){this._cursor=t||"default",this._maskElement&&(this._maskElement.style.cursor=this._cursor)}};r.prototype._launch=function(){var t=this,e=(new Date).getTime();if(e>=t._endTime)return"function"==typeof t._opts.render&&t._opts.render(t._opts.transition(1)),void("function"==typeof t._opts.finish&&t._opts.finish());t.schedule=t._opts.transition((e-t._beginTime)/t._opts.duration),"function"==typeof t._opts.render&&t._opts.render(t.schedule),t.terminative||(t._timer=setTimeout(function(){t._launch()},1e3/t._opts.fps))};var h={linear:function(t){return t},reverse:function(t){return 1-t},easeInQuad:function(t){return t*t},easeInCubic:function(t){return Math.pow(t,3)},easeOutQuad:function(t){return-(t*(t-2))},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutQuad:function(t){return t<.5?t*t*2:-2*(t-2)*t-1},easeInOutCubic:function(t){return t<.5?4*Math.pow(t,3):4*Math.pow(t-1,3)+1},easeInOutSine:function(t){return(1-Math.cos(Math.PI*t))/2}}}()},function(t,e,i){i(0),i(2),i(9),i(3),i(5),i(8),i(1),i(7),i(4),i(10),i(6)}]);